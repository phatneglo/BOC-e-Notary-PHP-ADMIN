import{d as Z,r as m,h as q,j as c,k as Y,w as n,aD as M,l,D as o,aB as D,aJ as Q,b2 as re,C as ee,B as g,E as L,a$ as J,n as _,aX as O,F as R,aM as de,J as j,aA as w,_ as ue,c as me,e as ce,g as pe,a8 as ve,o as fe,az as ye,t as x,aF as A,aE as ge,aH as P,aC as _e,N as X,b5 as K,aG as be}from"./index.fce983f6.js";import{_ as W}from"./template-placeholder.c7d8c99e.js";import{d as he}from"./date.fa2db621.js";import{u as Te}from"./template.a3d0002e.js";import{u as xe}from"./templateSection.396d082e.js";import{Q as qe}from"./QExpansionItem.a239d311.js";import"./axios.2d0d75cc.js";const we={class:"row q-col-gutter-md"},De={class:"col-12 col-md-6"},Ce={class:"col-12 col-md-6"},Se={class:"col-12"},ke={key:0,class:"text-negative text-caption q-mt-xs"},Fe={class:"row q-col-gutter-md q-mb-md"},Ue={class:"col-12"},Ve={class:"col-12 col-md-4"},$e={class:"col-12 col-md-3"},Ee={class:"col-12 col-md-3"},Ne={class:"col-12 col-md-2 flex"},Qe={class:"flex justify-center q-mt-md"},Me=Z({__name:"CustomTemplateUpload",props:{customName:{type:String,default:""},customDescription:{type:String,default:""},customDocument:{type:Object,default:null},acceptTerms:{type:Boolean,default:!1},loading:{type:Boolean,default:!1},showAdvanced:{type:Boolean,default:!0}},emits:["update:customName","update:customDescription","update:customDocument","update:acceptTerms","file-selected","upload","cancel","update:fields"],setup(h,{emit:C}){const f=h,p=C,v=m(0),r=m(!1),y=m([{name:"",type:"text",placeholder:"",required:!1}]),V=[{label:"Text",value:"text"},{label:"Email",value:"email"},{label:"Number",value:"number"},{label:"Date",value:"date"},{label:"Textarea",value:"textarea"},{label:"Select",value:"select"},{label:"Checkbox",value:"checkbox"},{label:"Radio",value:"radio"}],b=()=>{y.value.push({name:"",type:"text",placeholder:"",required:!1}),p("update:fields",y.value)},S=d=>{y.value.splice(d,1),p("update:fields",y.value)},U=q(()=>f.customName&&f.customDocument&&f.acceptTerms&&v.value<=10*1024*1024&&!r.value),B=d=>{p("update:customDocument",d),d?(v.value=d.size,v.value>10*1024*1024?(r.value=!0,w.create({type:"negative",message:"File is too large. Maximum size is 10MB."})):r.value=!1):(v.value=0,r.value=!1),p("file-selected",{file:d,size:v.value,error:r.value})};return(d,i)=>(c(),Y(M,{flat:"",class:"bg-white"},{default:n(()=>[l(D,{class:"q-pb-none"},{default:n(()=>i[6]||(i[6]=[o("div",{class:"text-h6"},"Upload Your Document",-1),o("p",{class:"text-grey-8"}," Upload your own document to use as a template. Supported formats: PDF, DOCX, DOC. ",-1)])),_:1}),l(D,null,{default:n(()=>[o("div",we,[o("div",De,[l(Q,{"model-value":h.customName,"onUpdate:modelValue":i[0]||(i[0]=s=>d.$emit("update:customName",s)),label:"Template Name *",outlined:"",dense:"",rules:[s=>!!s||"Template name is required"]},null,8,["model-value","rules"])]),o("div",Ce,[l(Q,{"model-value":h.customDescription,"onUpdate:modelValue":i[1]||(i[1]=s=>d.$emit("update:customDescription",s)),label:"Description",outlined:"",dense:""},null,8,["model-value"])]),o("div",Se,[l(re,{"model-value":h.customDocument,"onUpdate:modelValue":i[2]||(i[2]=s=>B(s)),label:"Select Document *",outlined:"",accept:".pdf,.doc,.docx",rules:[s=>!!s||"Document is required"]},{prepend:n(()=>[l(ee,{name:"fa-solid fa-file-upload"})]),_:1},8,["model-value","rules"]),i[7]||(i[7]=o("div",{class:"text-caption text-grey-8 q-mt-xs"}," Maximum file size: 10MB ",-1)),r.value?(c(),g("div",ke," File is too large. Maximum size is 10MB. ")):L("",!0)])])]),_:1}),l(D,null,{default:n(()=>[o("div",Fe,[o("div",Ue,[l(J,{"model-value":h.acceptTerms,"onUpdate:modelValue":i[3]||(i[3]=s=>d.$emit("update:acceptTerms",s)),label:"I confirm that I have the right to use this document and it does not contain any confidential or sensitive information"},null,8,["model-value"])])])]),_:1}),l(O,{align:"right"},{default:n(()=>[l(_,{outline:"",label:"Cancel",color:"primary","no-caps":"",onClick:i[4]||(i[4]=s=>d.$emit("cancel"))}),l(_,{unelevated:"",label:"Upload Template",color:"primary","no-caps":"",onClick:i[5]||(i[5]=s=>d.$emit("upload")),loading:h.loading,disable:!U.value},null,8,["loading","disable"])]),_:1}),h.showAdvanced?(c(),Y(D,{key:0,class:"q-pt-none"},{default:n(()=>[l(qe,{"expand-separator":"",icon:"fa-solid fa-cog",label:"Advanced Options","header-class":"text-primary"},{default:n(()=>[l(M,null,{default:n(()=>[l(D,null,{default:n(()=>[i[8]||(i[8]=o("div",{class:"text-subtitle2 q-mb-sm"},"Form Fields",-1)),i[9]||(i[9]=o("p",{class:"text-caption q-mb-md"}," Define custom form fields for your template. These fields will be available when creating a document from this template. ",-1)),(c(!0),g(j,null,R(y.value,(s,k)=>(c(),g("div",{key:k,class:"row q-col-gutter-sm q-mb-md items-center"},[o("div",Ve,[l(Q,{modelValue:s.name,"onUpdate:modelValue":u=>s.name=u,label:"Field Name *",dense:"",outlined:"",rules:[u=>!!u||"Field name is required"]},null,8,["modelValue","onUpdate:modelValue","rules"])]),o("div",$e,[l(de,{modelValue:s.type,"onUpdate:modelValue":u=>s.type=u,options:V,label:"Field Type *",dense:"",outlined:"","emit-value":"","map-options":""},null,8,["modelValue","onUpdate:modelValue"])]),o("div",Ee,[l(Q,{modelValue:s.placeholder,"onUpdate:modelValue":u=>s.placeholder=u,label:"Placeholder",dense:"",outlined:""},null,8,["modelValue","onUpdate:modelValue"])]),o("div",Ne,[l(J,{modelValue:s.required,"onUpdate:modelValue":u=>s.required=u,label:"Required",class:"q-mr-md"},null,8,["modelValue","onUpdate:modelValue"]),l(_,{round:"",flat:"",color:"negative",size:"sm",icon:"fa-solid fa-trash",onClick:u=>S(k)},null,8,["onClick"])])]))),128)),o("div",Qe,[l(_,{color:"primary",outline:"",icon:"fa-solid fa-plus",label:"Add Field",onClick:b})])]),_:1})]),_:1})]),_:1})]),_:1})):L("",!0)]),_:1}))}});const Be={class:"content-container q-pa-md q-pb-xl"},ze={class:"row items-center q-mb-md"},Ie={class:"col"},Ae={class:"text-h5 q-my-none"},Pe={class:"text-grey-8 q-mb-none"},Ye={class:"col-auto row q-gutter-sm"},Le={key:0,class:"q-pa-xl flex flex-center"},Oe={key:1,class:"text-center q-pa-xl"},Re={key:2},je={class:"row q-col-gutter-md"},Ge={class:"absolute-bottom text-subtitle2 text-weight-bold bg-primary-7 text-white q-pa-xs"},He={class:"text-subtitle1 ellipsis-2-lines"},Je={class:"text-caption text-grey-8 q-mt-xs"},Xe={class:"q-pa-md"},Ke={class:"row q-col-gutter-md"},We={class:"absolute-bottom text-subtitle2 text-weight-bold bg-primary-7 text-white q-pa-xs"},Ze={class:"text-subtitle1 ellipsis-2-lines"},et={key:0,class:"text-caption text-grey-8 q-mt-xs"},tt=Z({__name:"TemplateSelectionPage",setup(h){const C=me(),f=ce(),p=q(()=>f.query.edit==="true"),v=q(()=>f.query.template_id);q(()=>f.query.user_template_id),q(()=>f.query.is_custom==="true");const r=Te(),y=xe(),V=pe(),b=m(null),S=q(()=>r.templates.filter(t=>t.owner_id===V.userId||String(t.owner_id)===String(V.userId))),U=q(()=>{let t=r.templates.filter(a=>a.is_system===!0||a.is_system==="t"||String(a.is_system)==="true");return t.length<3&&(t=r.templates.filter(a=>a.owner_id===null||a.owner_id===void 0?!(a.is_system===!1||a.is_system==="f"||String(a.is_system)==="false"):!1)),t}),B=t=>t?he.formatDate(new Date(t),"MMM D, YYYY"):"",d=(t,a)=>t?t.length>a?t.substring(0,a)+"...":t:"",i=t=>{C.push({name:"edit-template",params:{id:t.template_id.toString()}})},s=m("library");ve([()=>p.value,()=>f.query],([t])=>{t?s.value="library":f.query.tab?s.value=f.query.tab.toString():s.value="library"},{immediate:!0});const k=m(!0),u=m(!1),F=m(""),$=m(""),E=m(null),z=m(!1),te=m(0),N=m([{id:"field_1",name:"full_name",label:"Full Name",type:"text",placeholder:"Enter your full name",help_text:"",required:!0,section_name:"Default",width:"full"}]),G=m([{id:"default",name:"Default"}]);q(()=>F.value&&N.value.length>0);const le=async()=>{k.value=!0;try{await r.fetchTemplates(),await r.fetchTemplateCategories(),console.log(`Loaded ${r.templates.length} templates:`),console.log("- System templates:",U.value.length),console.log("- User templates:",S.value.length)}catch(t){console.error("Error loading templates:",t),w.create({type:"negative",message:"Failed to load templates. Please try again later."})}finally{k.value=!1}},ae=async t=>{try{const e=await(r.fetchTemplateDetails||r.getTemplateDetails).call(r,t.template_id),T=e.data||e;if(T)try{await y.fetchSections(t.template_id),T.sections=y.sections}catch(ie){console.error("Error loading template sections:",ie)}b.value&&b.value.setTemplateHtml(T.html_content||"")}catch(a){console.error("Error loading template preview:",a),w.create({type:"negative",message:"Failed to load template preview"}),b.value&&b.value.setTemplateHtml("")}},I=async({template:t,customName:a})=>{try{C.push({path:"/user/document/new",query:{template_id:t.template_id}})}catch(e){console.error("Error creating document:",e),w.create({type:"negative",message:"Failed to create document"}),b.value&&b.value.setIsSaving(!1)}},oe=({file:t,size:a,error:e})=>{te.value=a},se=async()=>{if(!(!F.value||!E.value||!z.value)){u.value=!0;try{const t=new FormData;t.append("template_name",F.value),t.append("description",$.value||""),t.append("document",E.value),p.value&&v.value&&t.append("template_id",v.value);const a=await r.uploadCustomTemplate(t);w.create({type:"positive",message:p.value?"Template updated successfully":"Template uploaded successfully"}),C.push("/user/templates")}catch(t){console.error("Error processing custom template:",t),w.create({type:"negative",message:p.value?"Failed to update template":"Failed to upload template"})}finally{u.value=!1}}},H=()=>{C.push("/user/templates")};fe(async()=>{await le(),console.log("Templates loaded:",r.templates.length),console.log("System templates:",U.value.length),console.log("User templates:",S.value.length),console.log("Template values:",r.templates.map(t=>({id:t.template_id,name:t.template_name,is_system:t.is_system,owner_id:t.owner_id}))),p.value&&await ne()});const ne=async()=>{try{let t;if(v.value&&(t=(await r.fetchTemplateDetails(v.value)).data,F.value=t.template_name,$.value=t.description||"",await y.fetchSections(v.value),G.value=y.sections.map(e=>({id:e.id,name:e.name,order:e.order||0})),console.log("Received sections:",y.sections),console.log("Mapped sections:",G.value),t.fields&&t.fields.length>0?N.value=t.fields.map(e=>({id:`field_${e.field_id}`,name:e.field_name,label:e.field_label,type:e.field_type,placeholder:e.placeholder||"",help_text:e.help_text||"",required:e.is_required,section_name:e.section_name||"Default",width:e.field_width||"full",options:Array.isArray(e.field_options)?e.field_options:[]})):N.value=[{id:"field_"+Date.now(),name:"default_field",label:"Default Field",type:"text",placeholder:"Enter value",help_text:"",required:!0,section_name:"Default",width:"full"}]),t&&t.is_system&&b.value){const a=r.templates.find(e=>e.template_id==v.value);a&&b.value.loadTemplateForEdit(a)}w.create({type:"positive",message:"Template loaded for editing",timeout:2e3})}catch(t){console.error("Error loading template for editing:",t),w.create({type:"negative",message:"Failed to load template for editing",timeout:2e3})}};return(t,a)=>(c(),Y(ye,{class:"template-selection-page bg-grey-1"},{default:n(()=>[o("div",Be,[o("div",ze,[o("div",Ie,[o("h1",Ae,x(p.value?"Edit Template":"Select Template for New Document"),1),o("p",Pe,x(p.value?"Modify your template settings or fields":"Choose from our template library or upload your own document"),1)]),o("div",Ye,[l(_,{color:"green",unelevated:"",label:"Create Template",icon:"fa-solid fa-pencil-alt","no-caps":"",to:{name:"create-template"},class:"q-mr-sm"}),l(_,{outline:"",color:"primary",label:"Back to Templates",icon:"fa-solid fa-arrow-left","no-caps":"",onClick:H})])]),l(ge,{modelValue:s.value,"onUpdate:modelValue":a[0]||(a[0]=e=>s.value=e),dense:"",class:"text-grey q-mb-md","active-color":"primary","indicator-color":"primary",align:"left","narrow-indicator":""},{default:n(()=>[l(A,{name:"myTemplates",label:"My Templates"}),l(A,{name:"library",label:"Template Library"}),l(A,{name:"upload",label:"Upload Custom Document"})]),_:1},8,["modelValue"]),l(be,{modelValue:s.value,"onUpdate:modelValue":a[6]||(a[6]=e=>s.value=e),animated:""},{default:n(()=>[l(P,{name:"myTemplates",class:"q-pa-none"},{default:n(()=>[k.value?(c(),g("div",Le,[l(_e,{color:"primary",size:"3em"}),a[7]||(a[7]=o("span",{class:"q-ml-sm text-primary"},"Loading your templates...",-1))])):S.value.length===0?(c(),g("div",Oe,[l(ee,{name:"fa-solid fa-file-circle-exclamation",size:"3em",color:"grey-6"}),a[8]||(a[8]=o("div",{class:"text-h6 q-mt-md"},"No Custom Templates",-1)),a[9]||(a[9]=o("p",{class:"text-grey-8"}," You haven't created any custom templates yet. ",-1)),l(_,{color:"primary",unelevated:"",label:"Create Template",icon:"fa-solid fa-pencil-alt","no-caps":"",to:{name:"create-template"},class:"q-mt-md"})])):(c(),g("div",Re,[o("div",je,[(c(!0),g(j,null,R(S.value,e=>(c(),g("div",{key:e.template_id,class:"col-12 col-sm-6 col-md-4 col-lg-3"},[l(M,{class:"template-card"},{default:n(()=>[l(X,{src:W,height:"140px",class:"template-image"},{default:n(()=>[o("div",Ge,x(e.category_name||"General"),1)]),_:2},1024),l(D,null,{default:n(()=>[o("div",He,x(e.template_name),1),o("div",Je," Added: "+x(B(e.created_at)),1)]),_:2},1024),l(O,{align:"right"},{default:n(()=>[l(_,{flat:"",color:"primary",label:"Edit",icon:"fa-solid fa-pen",onClick:T=>i(e)},null,8,["onClick"]),l(_,{unelevated:"",color:"primary",label:"Use",icon:"fa-solid fa-check",onClick:T=>I({template:e})},null,8,["onClick"])]),_:2},1024)]),_:2},1024)]))),128))])]))]),_:1}),l(P,{name:"library",class:"q-pa-none"},{default:n(()=>[o("div",Xe,[o("div",Ke,[(c(!0),g(j,null,R(U.value,e=>(c(),g("div",{key:e.template_id,class:"col-12 col-sm-6 col-md-4 col-lg-3"},[l(M,{class:"template-card cursor-pointer",onClick:T=>I({template:e})},{default:n(()=>[l(X,{src:W,height:"140px",class:"template-image"},{default:n(()=>[o("div",We,x(e.category_name||"General"),1),l(_,{class:"absolute-top-right q-ma-sm",round:"",flat:"",color:"white",icon:"fa-solid fa-eye",onClick:K(T=>ae(e),["stop"])},null,8,["onClick"])]),_:2},1024),l(D,null,{default:n(()=>[o("div",Ze,x(e.template_name),1),e.description?(c(),g("div",et,x(d(e.description,100)),1)):L("",!0)]),_:2},1024),l(O,{align:"center"},{default:n(()=>[l(_,{unelevated:"",color:"primary",class:"full-width",label:"Use Template",icon:"fa-solid fa-file-alt",onClick:K(T=>I({template:e}),["stop"])},null,8,["onClick"])]),_:2},1024)]),_:2},1032,["onClick"])]))),128))])])]),_:1}),l(P,{name:"upload",class:"q-pa-none"},{default:n(()=>[l(Me,{"custom-name":F.value,"custom-description":$.value,"custom-document":E.value,"accept-terms":z.value,loading:u.value,"show-advanced":!0,"onUpdate:customName":a[1]||(a[1]=e=>F.value=e),"onUpdate:customDescription":a[2]||(a[2]=e=>$.value=e),"onUpdate:customDocument":a[3]||(a[3]=e=>E.value=e),"onUpdate:acceptTerms":a[4]||(a[4]=e=>z.value=e),onFileSelected:oe,onUpload:se,onCancel:H,"onUpdate:fields":a[5]||(a[5]=e=>N.value=e)},null,8,["custom-name","custom-description","custom-document","accept-terms","loading"])]),_:1})]),_:1},8,["modelValue"])])]),_:1}))}});var dt=ue(tt,[["__scopeId","data-v-4381c445"]]);export{dt as default};
