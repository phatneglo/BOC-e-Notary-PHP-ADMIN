import{_ as pe,d as ve,c as _e,e as ye,r as y,o as ge,j as n,k as g,l as a,az as be,aA as x,ay as q,F as o,m as t,p,s as D,D as c,aC as G,aB as _,A as J,I as b,J as v,B as r,q as u,t as i,K,G as W,y as we,C as xe,aE as F,aD as E,E as N,M as qe,x as Z,H as $,aZ as X,aY as De,S as R}from"./index.eb3f7448.js";import{Q as B}from"./QTooltip.8ab756ef.js";import{d as ee}from"./date.ffd58b11.js";import{u as he}from"./document.cc7e019b.js";import{f as I,a as ke}from"./formatters.87a426ac.js";import"./document.8ce8a7f2.js";const Ce={class:"content-container q-pa-md q-pb-xl"},Pe={class:"row items-center q-mb-md"},Le={class:"col-auto"},Ee={key:0,class:"q-pa-xl flex flex-center"},Se={key:1,class:"row q-col-gutter-md"},Fe={class:"col-12 col-lg-4"},Qe={key:0},ze={class:"row items-center justify-between q-mb-sm"},Me={class:"text-body1"},Te={class:"row items-center justify-between text-weight-bold"},Ne={class:"text-body1"},$e={key:0,class:"text-center q-py-md"},Re={class:"col-12 col-lg-8"},Be={class:"row items-center justify-between"},Ie={key:0,class:"flex flex-center full-height"},Ae=["src"],Ve=["innerHTML"],Ye={key:3,class:"flex flex-center full-height text-grey-7"},He={class:"text-center"},je={class:"text-h6"},Ue=["src"],Oe=["innerHTML"],Ge={key:2,class:"flex flex-center full-height text-grey-7"},Je={class:"text-center"},Ke={key:0,class:"bg-grey-2 rounded-borders q-pa-sm q-mb-md"},We={class:"row justify-between q-mt-sm"},Ze=ve({__name:"DocumentReviewPage",setup(Xe){const w=_e(),te=ye(),ae=he(),d=y(null),s=y({document_id:null,document_reference:"",document_title:"Loading document...",template_id:null,template_name:"Loading...",status:"draft",created_at:"",updated_at:"",company_name:"",customs_entry_number:"",date_of_entry:null,document_html:'<div style="text-align: center; padding: 20px;">Loading document content...</div>',notes:"",document_data:{},parent_document_id:null,version:1}),Q=y([]),k=y(0),L=y(!0),z=y(!1),C=y(!1),h=y(""),M=y(!1),S=y(!1),le=l=>l?ee.formatDate(new Date(l),"MMMM D, YYYY"):"",T=l=>l?ee.formatDate(new Date(l),"MMMM D, YYYY h:mm A"):"",se=l=>{switch(l){case"draft":return"blue-grey";case"submitted":return"blue";case"pending_payment":return"purple";case"in_queue":return"orange";case"processing":return"amber";case"notarized":return"positive";case"rejected":return"negative";default:return"grey"}},oe=async()=>{L.value=!0;try{if(d.value=te.params.id,!d.value){x.create({type:"negative",message:"Document ID not provided"}),w.push("/user/inbox");return}console.log(`Loading document with ID: ${d.value}`);const l=await ae.fetchDocument(d.value);if(!l){x.create({type:"negative",message:"Document not found"}),w.push("/user/inbox");return}if(!l.document_title||!l.status){x.create({type:"negative",message:"Document data is incomplete or corrupted"}),console.error("Incomplete document data:",l),w.push("/user/inbox");return}s.value=l,console.log("Document loaded successfully:",s.value),s.value.template_id&&await ne(s.value.template_id),await ue(),await re()}catch(l){console.error("Error loading document:",l),x.create({type:"negative",message:"Failed to load document details. Please try again."}),w.push("/user/inbox")}finally{L.value=!1}},ne=async l=>{try{const e=await q.get(`/templates/${l}`);e.data.success&&(k.value=e.data.data.fee_amount||0)}catch(e){console.error("Error loading template fee:",e)}},ue=async()=>{try{const l=await q.get(`/documents/${d.value}/attachments`);l.data.success&&(Q.value=l.data.data||[])}catch(l){console.error("Error loading attachments:",l)}},re=async()=>{if(!!d.value){z.value=!0;try{console.log("Generating document preview for ID:",d.value);try{const l=await q.get(`/documents/${d.value}/preview`);l.data.success&&l.data.data.document_html?(s.value.document_html=l.data.data.document_html,console.log("HTML preview loaded successfully")):console.warn("No HTML content in preview response")}catch(l){console.error("Error generating HTML preview:",l)}try{const l=await q.post(`/documents/${d.value}/convert`);l.data.success?(h.value=`${q.defaults.baseURL}/${l.data.data.pdf_path}`,console.log("PDF preview generated successfully:",h.value)):console.warn("Failed to generate PDF preview")}catch(l){console.error("Error generating PDF preview:",l)}!s.value.document_html&&!h.value&&(s.value.document_html='<div style="padding: 20px; text-align: center;"><h3>Preview not available</h3><p>Document preview could not be generated at this time.</p></div>')}catch(l){console.error("Error in preview generation process:",l),s.value.document_html='<div style="padding: 20px; text-align: center;"><h3>Preview Error</h3><p>An error occurred while generating the document preview.</p></div>'}finally{z.value=!1}}},ie=()=>{M.value=!0},de=l=>{const e=s.value.createElement("a");e.href=`${q.defaults.baseURL}/api/documents/${d.value}/attachments/${l.attachment_id}/download`,e.target="_blank",e.download=l.file_name,s.value.body.appendChild(e),e.click(),s.value.body.removeChild(e)},A=()=>{if(!d.value)return;const l=s.value.createElement("a");l.href=`${q.defaults.baseURL}/api/documents/${d.value}/download`,l.target="_blank",s.value.body.appendChild(l),l.click(),s.value.body.removeChild(l)},me=()=>{S.value=!0},ce=()=>{s.value&&s.value.request_info?w.push({path:"/user/payment",query:{request_id:s.value.request_info.request_id}}):x.create({type:"negative",message:"Payment information not found. Please contact support."})},fe=async()=>{var l,e,m,P,V,Y,H,j,U,O;if(!!d.value){C.value=!0;try{const f=await q.post(`/documents/${d.value}/submit`);if(f.data.success)x.create({type:"positive",message:"Document submitted successfully"}),S.value=!1,f.data.data.payment_required?w.push({path:"/user/payment",query:{request_id:f.data.data.request_id}}):w.push("/user/inbox");else throw new Error(f.data.message||"Failed to submit document")}catch(f){console.error("Error submitting document:",f),((e=(l=f.response)==null?void 0:l.data)==null?void 0:e.success)===!1&&((V=(P=(m=f.response)==null?void 0:m.data)==null?void 0:P.data)==null?void 0:V.status)==="pending_payment"&&((j=(H=(Y=f.response)==null?void 0:Y.data)==null?void 0:H.data)==null?void 0:j.request_id)?(x.create({type:"info",message:"This document is awaiting payment. Redirecting to payment page..."}),w.push({path:"/user/payment",query:{request_id:f.response.data.data.request_id}})):x.create({type:"negative",message:((O=(U=f.response)==null?void 0:U.data)==null?void 0:O.message)||f.message||"Failed to submit document"})}finally{C.value=!1}}};return ge(()=>{oe()}),(l,e)=>(n(),g(be,{class:"document-review-page bg-grey-1"},{default:a(()=>[o("div",Ce,[o("div",Pe,[e[2]||(e[2]=o("div",{class:"col"},[o("h1",{class:"text-h5 q-my-none"},"Document Review"),o("p",{class:"text-grey-8 q-mb-none"}," Review your document before submission for notarization ")],-1)),o("div",Le,[t(p,{outline:"",color:"primary",label:"Edit Document",icon:"fa-solid fa-pencil","no-caps":"",class:"q-mr-sm",to:`/user/document/${d.value}/edit`,disable:C.value},null,8,["to","disable"]),s.value.status==="draft"?(n(),g(p,{key:0,unelevated:"",color:"primary",label:"Submit for Notarization",icon:"fa-solid fa-paper-plane","no-caps":"",onClick:me,loading:C.value,disable:L.value},null,8,["loading","disable"])):s.value.status==="pending_payment"?(n(),g(p,{key:1,unelevated:"",color:"secondary",label:"Continue Payment",icon:"fa-solid fa-credit-card","no-caps":"",onClick:ce,disable:L.value||!s.value.request_info},null,8,["disable"])):D("",!0)])]),L.value?(n(),c("div",Ee,[t(G,{color:"primary",size:"3em"}),e[3]||(e[3]=o("span",{class:"q-ml-sm text-primary"},"Loading document details...",-1))])):(n(),c("div",Se,[o("div",Fe,[t(E,{flat:"",class:"bg-white"},{default:a(()=>[t(_,{class:"q-pb-none"},{default:a(()=>e[4]||(e[4]=[o("div",{class:"text-h6"},"Document Overview",-1)])),_:1}),t(_,null,{default:a(()=>[t(J,{bordered:"",separator:""},{default:a(()=>[t(b,null,{default:a(()=>[t(v,null,{default:a(()=>[t(r,{caption:""},{default:a(()=>e[5]||(e[5]=[u("Document Title")])),_:1}),t(r,null,{default:a(()=>[u(i(s.value.document_title),1)]),_:1})]),_:1})]),_:1}),t(b,null,{default:a(()=>[t(v,null,{default:a(()=>[t(r,{caption:""},{default:a(()=>e[6]||(e[6]=[u("Template")])),_:1}),t(r,null,{default:a(()=>[u(i(s.value.template_name),1)]),_:1})]),_:1})]),_:1}),s.value.company_name?(n(),g(b,{key:0},{default:a(()=>[t(v,null,{default:a(()=>[t(r,{caption:""},{default:a(()=>e[7]||(e[7]=[u("Company Name")])),_:1}),t(r,null,{default:a(()=>[u(i(s.value.company_name),1)]),_:1})]),_:1})]),_:1})):D("",!0),s.value.customs_entry_number?(n(),g(b,{key:1},{default:a(()=>[t(v,null,{default:a(()=>[t(r,{caption:""},{default:a(()=>e[8]||(e[8]=[u("Customs Entry Number")])),_:1}),t(r,null,{default:a(()=>[u(i(s.value.customs_entry_number),1)]),_:1})]),_:1})]),_:1})):D("",!0),s.value.date_of_entry?(n(),g(b,{key:2},{default:a(()=>[t(v,null,{default:a(()=>[t(r,{caption:""},{default:a(()=>e[9]||(e[9]=[u("Date of Entry")])),_:1}),t(r,null,{default:a(()=>[u(i(le(s.value.date_of_entry)),1)]),_:1})]),_:1})]),_:1})):D("",!0),s.value.notes?(n(),g(b,{key:3},{default:a(()=>[t(v,null,{default:a(()=>[t(r,{caption:""},{default:a(()=>e[10]||(e[10]=[u("Notes")])),_:1}),t(r,null,{default:a(()=>[(n(!0),c(K,null,W(l.formattedNotes,(m,P)=>(n(),c("span",{key:P},[u(i(m),1),P<l.formattedNotes.length-1?(n(),c("br",Qe)):D("",!0)]))),128))]),_:1})]),_:1})]),_:1})):D("",!0),t(b,null,{default:a(()=>[t(v,null,{default:a(()=>[t(r,{caption:""},{default:a(()=>e[11]||(e[11]=[u("Created On")])),_:1}),t(r,null,{default:a(()=>[u(i(T(s.value.created_at)),1)]),_:1})]),_:1})]),_:1}),t(b,null,{default:a(()=>[t(v,null,{default:a(()=>[t(r,{caption:""},{default:a(()=>e[12]||(e[12]=[u("Last Updated")])),_:1}),t(r,null,{default:a(()=>[u(i(T(s.value.updated_at)),1)]),_:1})]),_:1})]),_:1}),t(b,null,{default:a(()=>[t(v,null,{default:a(()=>[t(r,{caption:""},{default:a(()=>e[13]||(e[13]=[u("Status")])),_:1}),t(r,null,{default:a(()=>[t(we,{color:se(s.value.status),class:"text-capitalize"},{default:a(()=>[u(i(s.value.status),1)]),_:1},8,["color"])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),k.value>0?(n(),g(_,{key:0,class:"q-pt-none"},{default:a(()=>[t(xe,{class:"q-my-md"}),e[16]||(e[16]=o("div",{class:"text-subtitle1 q-mb-sm"},"Notarization Fee",-1)),o("div",ze,[e[14]||(e[14]=o("div",{class:"text-body1"},"Template Fee:",-1)),o("div",Me,"\u20B1"+i(F(I)(k.value)),1)]),o("div",Te,[e[15]||(e[15]=o("div",{class:"text-body1"},"Total:",-1)),o("div",Ne,"\u20B1"+i(F(I)(k.value)),1)]),e[17]||(e[17]=o("div",{class:"text-caption text-grey-7 q-mt-sm"}," Payment will be required after document submission. ",-1))]),_:1})):D("",!0)]),_:1}),t(E,{flat:"",class:"bg-white q-mt-md"},{default:a(()=>[t(_,{class:"q-pb-none"},{default:a(()=>e[18]||(e[18]=[o("div",{class:"text-h6"},"Supporting Documents",-1)])),_:1}),t(_,null,{default:a(()=>[Q.value.length===0?(n(),c("div",$e,[t(N,{name:"fa-solid fa-file-circle-exclamation",size:"2em",color:"grey-6"}),e[19]||(e[19]=o("div",{class:"text-subtitle1 q-mt-sm"}," No supporting documents ",-1)),t(p,{flat:"",color:"primary",label:"Add Supporting Document",icon:"fa-solid fa-plus","no-caps":"",class:"q-mt-sm",to:`/user/document/${d.value}/edit`,disable:C.value},null,8,["to","disable"])])):(n(),g(J,{key:1,separator:""},{default:a(()=>[(n(!0),c(K,null,W(Q.value,m=>(n(),g(b,{key:m.attachment_id,class:"q-py-md"},{default:a(()=>[t(v,{avatar:""},{default:a(()=>[t(qe,{color:"primary","text-color":"white",icon:"fa-solid fa-file-pdf"})]),_:1}),t(v,null,{default:a(()=>[t(r,null,{default:a(()=>[u(i(m.file_name),1)]),_:2},1024),t(r,{caption:""},{default:a(()=>[u(i(F(ke)(m.file_size))+" - "+i(T(m.uploaded_at)),1)]),_:2},1024),t(r,{caption:"",class:"text-primary"},{default:a(()=>[u(i(m.description),1)]),_:2},1024)]),_:2},1024),t(v,{side:""},{default:a(()=>[t(p,{flat:"",round:"",color:"primary",icon:"fa-solid fa-download",onClick:P=>de(m)},{default:a(()=>[t(B,null,{default:a(()=>e[20]||(e[20]=[u("Download")])),_:1})]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1024))),128))]),_:1}))]),_:1})]),_:1})]),o("div",Re,[t(E,{flat:"",class:"bg-white document-preview-card"},{default:a(()=>[t(_,{class:"q-pb-none"},{default:a(()=>[o("div",Be,[e[23]||(e[23]=o("div",{class:"text-h6"},"Document Preview",-1)),o("div",null,[t(p,{flat:"",round:"",color:"primary",icon:"fa-solid fa-expand",onClick:ie},{default:a(()=>[t(B,null,{default:a(()=>e[21]||(e[21]=[u("Full Screen")])),_:1})]),_:1}),t(p,{flat:"",round:"",color:"primary",icon:"fa-solid fa-download",onClick:A},{default:a(()=>[t(B,null,{default:a(()=>e[22]||(e[22]=[u("Download")])),_:1})]),_:1})])])]),_:1}),t(_,{class:"preview-container"},{default:a(()=>[z.value?(n(),c("div",Ie,[t(G,{color:"primary",size:"3em"}),e[24]||(e[24]=o("span",{class:"q-ml-sm"},"Loading document preview...",-1))])):h.value?(n(),c("iframe",{key:1,src:h.value,class:"preview-iframe"},null,8,Ae)):s.value.document_html?(n(),c("div",{key:2,class:"preview-html",innerHTML:s.value.document_html},null,8,Ve)):(n(),c("div",Ye,[o("div",He,[t(N,{name:"fa-solid fa-file-alt",size:"3em"}),e[25]||(e[25]=o("div",{class:"q-mt-sm"},"Preview not available",-1))])]))]),_:1})]),_:1})])]))]),t(X,{modelValue:M.value,"onUpdate:modelValue":e[0]||(e[0]=m=>M.value=m),maximized:"",persistent:""},{default:a(()=>[t(E,null,{default:a(()=>[t(_,{class:"row items-center q-py-sm bg-primary text-white"},{default:a(()=>[o("div",je," Document Preview: "+i(s.value.document_title),1),t(Z),t(p,{icon:"fa-solid fa-download",flat:"",round:"",dense:"",onClick:A}),$(t(p,{icon:"fa-solid fa-times",flat:"",round:"",dense:""},null,512),[[R]])]),_:1}),t(_,{class:"full-preview-container"},{default:a(()=>[h.value?(n(),c("iframe",{key:0,src:h.value,class:"full-preview-iframe"},null,8,Ue)):s.value.document_html?(n(),c("div",{key:1,class:"full-preview-html",innerHTML:s.value.document_html},null,8,Oe)):(n(),c("div",Ge,[o("div",Je,[t(N,{name:"fa-solid fa-file-alt",size:"3em"}),e[26]||(e[26]=o("div",{class:"q-mt-sm"},"Preview not available",-1))])]))]),_:1})]),_:1})]),_:1},8,["modelValue"]),t(X,{modelValue:S.value,"onUpdate:modelValue":e[1]||(e[1]=m=>S.value=m),persistent:""},{default:a(()=>[t(E,{style:{"min-width":"350px"}},{default:a(()=>[t(_,{class:"row items-center"},{default:a(()=>[e[27]||(e[27]=o("div",{class:"text-h6"},"Submit for Notarization",-1)),t(Z),$(t(p,{icon:"fa-solid fa-times",flat:"",round:"",dense:""},null,512),[[R]])]),_:1}),t(_,null,{default:a(()=>[e[31]||(e[31]=o("p",null,"Are you sure you want to submit this document for notarization?",-1)),k.value>0?(n(),c("div",Ke,[e[29]||(e[29]=o("div",{class:"text-subtitle2"},"Fee Summary:",-1)),o("div",We,[e[28]||(e[28]=o("div",null,"Notarization Fee:",-1)),o("div",null,"\u20B1"+i(F(I)(k.value)),1)]),e[30]||(e[30]=o("div",{class:"text-caption text-grey-7 q-mt-xs"}," Payment will be required after submission. ",-1))])):D("",!0),e[32]||(e[32]=o("p",{class:"text-caption text-grey-7"}," Once submitted, you will not be able to edit the document unless it is rejected. ",-1))]),_:1}),t(De,{align:"right"},{default:a(()=>[$(t(p,{flat:"",label:"Cancel",color:"primary"},null,512),[[R]]),t(p,{unelevated:"",label:"Submit",color:"primary",onClick:fe,loading:C.value},null,8,["loading"])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1}))}});var nt=pe(Ze,[["__scopeId","data-v-5a41b540"]]);export{nt as default};
