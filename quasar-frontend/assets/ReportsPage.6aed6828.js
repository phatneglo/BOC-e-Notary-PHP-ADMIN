import{_ as ee,d as te,c as ae,r as f,aX as T,h as Q,o as se,j as c,k as le,l,az as oe,b8 as re,bD as ne,F as a,m as t,aB as i,C as y,aK as F,aN as C,p as V,aD as g,D as _,aC as D,t as d,by as E,bE as A,bx as u,q as m,bF as de,y as ie}from"./index.fe3d6851.js";import{Q as ce}from"./QTooltip.de6ba31a.js";import{d as p}from"./date.fa239a2b.js";import{u as ue}from"./notary.21373e33.js";import{u as me}from"./template.15512ec4.js";import{u as _e}from"./useNotifications.14eff4b3.js";import"./axios.bcc89ad9.js";import"./notification.9e3a726c.js";const pe={class:"row q-col-gutter-md"},fe={class:"col-12"},ve={class:"row q-col-gutter-md"},ye={class:"col-12 col-md-3"},ge={class:"col-12 col-md-3"},be={class:"col-12 col-md-3"},De={class:"col-12 col-md-3"},we={class:"row q-mt-md"},xe={class:"col-12 col-md-3"},ke={class:"col-12 col-md-auto q-mt-md q-md-mt-none"},he={class:"col-12 col-md-auto q-mt-md q-md-mt-none"},qe={class:"col-12 col-md-6"},Ce={key:0,class:"text-center q-pa-lg"},Ve={key:1,class:"row q-col-gutter-md"},Ye={class:"col-6 col-md-3"},Pe={class:"text-h6 text-center"},Re={class:"col-6 col-md-3"},Se={class:"text-h6 text-center"},ze={class:"col-6 col-md-3"},Me={class:"text-h6 text-center"},Te={class:"col-6 col-md-3"},Qe={class:"text-h6 text-center"},Fe={class:"col-12 col-md-6"},Ee={key:0,class:"text-center q-pa-lg"},Ae={key:1,class:"chart-container"},Ne={class:"col-12"},Be={key:0,class:"text-center q-pa-lg"},je={key:1},Ie={class:"col-12"},Le={key:0,class:"text-center q-pa-lg"},Ue={key:1},Oe=te({__name:"ReportsPage",setup(Ge){const N=ae(),w=ue(),B=me(),{showNotification:b}=_e(),Y=f(null);let x=null;const v=f(!1),k=f(!1),h=f(!1),j=[{label:"All",value:"all"},{label:"Notarized",value:"notarized"},{label:"Rejected",value:"rejected"}],I=[{label:"PDF",value:"pdf"},{label:"Excel",value:"excel"},{label:"CSV",value:"csv"}],P=f([]),r=T({startDate:p.formatDate(p.subtractFromDate(new Date,{days:30}),"YYYY-MM-DD"),endDate:p.formatDate(new Date,"YYYY-MM-DD"),status:"all",templateId:null,format:"pdf"}),n=T({total_notarized:0,total_rejected:0,period_start:"",period_end:"",average_time:0,by_document_type:[],by_date:[]}),R=f([]),L=Q(()=>{const o=n.total_notarized+n.total_rejected;return o>0?Math.round(n.total_notarized/o*100):0}),U=Q(()=>n.by_document_type||[]),O=[{name:"template_name",label:"Document Type",field:"template_name",align:"left",sortable:!0},{name:"count",label:"Count",field:"count",align:"right",sortable:!0},{name:"percentage",label:"Percentage",field:"percentage",align:"right",sortable:!0}],G=[{name:"request_reference",label:"Reference",field:"request_reference",align:"left",sortable:!0},{name:"document_title",label:"Document Title",field:"document_title",align:"left",sortable:!0},{name:"user_name",label:"User",field:"user_name",align:"left",sortable:!0},{name:"status",label:"Status",field:"status",align:"left",sortable:!0},{name:"processed_at",label:"Processed Date",field:"processed_at",align:"left",sortable:!0},{name:"actions",label:"Actions",field:"actions",align:"center"}],$=o=>o?p.formatDate(o,"MMM D, YYYY h:mm A"):"",S=async()=>{v.value=!0;try{const o={start_date:r.startDate,end_date:r.endDate},e=await w.fetchSummary(o);Object.assign(n,e),await H()}catch(o){console.error("Error loading summary:",o),b({type:"negative",message:"Failed to load summary data"})}finally{v.value=!1}},z=async()=>{k.value=!0;try{const o={status:r.status!=="all"?r.status:void 0,start_date:r.startDate,end_date:r.endDate,page:1,per_page:10},e=await w.fetchProcessedDocuments(o);R.value=e.data||[]}catch(o){console.error("Error loading processed documents:",o),b({type:"negative",message:"Failed to load recent activity"})}finally{k.value=!1}},K=async()=>{try{const o=await B.fetchTemplates();P.value=o.map(e=>({label:e.template_name,value:e.template_id}))}catch(o){console.error("Error loading templates:",o)}},X=async()=>{h.value=!0;try{const o={start_date:r.startDate,end_date:r.endDate,status:r.status,template_id:r.templateId,format:r.format},e=await w.generateDetailedReport(o);window.open(e,"_blank"),b({type:"positive",message:"Report generated successfully"})}catch(o){console.error("Error generating report:",o),b({type:"negative",message:"Failed to generate report"})}finally{h.value=!1}},Z=()=>{r.startDate=p.formatDate(p.subtractFromDate(new Date,{days:30}),"YYYY-MM-DD"),r.endDate=p.formatDate(new Date,"YYYY-MM-DD"),r.status="all",r.templateId=null,r.format="pdf",S(),z()},H=async()=>{if(!n.by_date||n.by_date.length===0)return;await re();const o=Y.value;if(!o)return;x&&x.destroy();const{Chart:e,registerables:s}=await ne(()=>import("./chart.6d6733bd.js"),[]);e.register(...s);const M=n.by_date.map(q=>p.formatDate(q.date,"MMM D")),W=n.by_date.map(q=>q.count);x=new e(o,{type:"line",data:{labels:M,datasets:[{label:"Documents Processed",data:W,borderColor:"#1976D2",backgroundColor:"rgba(25, 118, 210, 0.1)",fill:!0,tension:.4}]},options:{responsive:!0,maintainAspectRatio:!1,plugins:{legend:{display:!1},tooltip:{mode:"index",intersect:!1}},scales:{y:{beginAtZero:!0,ticks:{precision:0}}}}})},J=o=>{N.push(`/notary/documents/${o}`)};return se(async()=>{await K(),await S(),await z()}),(o,e)=>(c(),le(oe,{padding:""},{default:l(()=>[a("div",pe,[e[19]||(e[19]=a("div",{class:"col-12"},[a("h4",{class:"q-mt-none q-mb-md"},"Notarization Reports")],-1)),a("div",fe,[t(g,{flat:"",bordered:""},{default:l(()=>[t(i,null,{default:l(()=>e[5]||(e[5]=[a("div",{class:"text-h6"},"Report Filters",-1)])),_:1}),t(y),t(i,null,{default:l(()=>[a("div",ve,[a("div",ye,[t(F,{filled:"",modelValue:r.startDate,"onUpdate:modelValue":e[0]||(e[0]=s=>r.startDate=s),label:"Start Date",type:"date",clearable:""},null,8,["modelValue"])]),a("div",ge,[t(F,{filled:"",modelValue:r.endDate,"onUpdate:modelValue":e[1]||(e[1]=s=>r.endDate=s),label:"End Date",type:"date",clearable:""},null,8,["modelValue"])]),a("div",be,[t(C,{filled:"",modelValue:r.status,"onUpdate:modelValue":e[2]||(e[2]=s=>r.status=s),options:j,label:"Status",clearable:"","emit-value":"","map-options":""},null,8,["modelValue"])]),a("div",De,[t(C,{filled:"",modelValue:r.templateId,"onUpdate:modelValue":e[3]||(e[3]=s=>r.templateId=s),options:P.value,label:"Document Type",clearable:"","emit-value":"","map-options":""},null,8,["modelValue","options"])])]),a("div",we,[a("div",xe,[t(C,{filled:"",modelValue:r.format,"onUpdate:modelValue":e[4]||(e[4]=s=>r.format=s),options:I,label:"Export Format","emit-value":"","map-options":""},null,8,["modelValue"])]),a("div",ke,[t(V,{color:"primary",label:"Generate Report",loading:h.value,onClick:X},null,8,["loading"])]),a("div",he,[t(V,{color:"secondary",label:"Reset Filters",flat:"",onClick:Z})])])]),_:1})]),_:1})]),a("div",qe,[t(g,{flat:"",bordered:""},{default:l(()=>[t(i,null,{default:l(()=>e[6]||(e[6]=[a("div",{class:"text-h6"},"Summary Statistics",-1)])),_:1}),t(y),t(i,null,{default:l(()=>[v.value?(c(),_("div",Ce,[t(D,{color:"primary",size:"3em"}),e[7]||(e[7]=a("div",{class:"q-mt-sm"},"Loading statistics...",-1))])):(c(),_("div",Ve,[a("div",Ye,[a("div",Pe,d(n.total_notarized||0),1),e[8]||(e[8]=a("div",{class:"text-subtitle2 text-center"},"Notarized",-1))]),a("div",Re,[a("div",Se,d(n.total_rejected||0),1),e[9]||(e[9]=a("div",{class:"text-subtitle2 text-center"},"Rejected",-1))]),a("div",ze,[a("div",Me,d(L.value)+"%",1),e[10]||(e[10]=a("div",{class:"text-subtitle2 text-center"},"Approval Rate",-1))]),a("div",Te,[a("div",Qe,d(n.average_time||0),1),e[11]||(e[11]=a("div",{class:"text-subtitle2 text-center"},"Avg. Time (min)",-1))])]))]),_:1})]),_:1})]),a("div",Fe,[t(g,{flat:"",bordered:"",class:"full-height"},{default:l(()=>[t(i,null,{default:l(()=>e[12]||(e[12]=[a("div",{class:"text-h6"},"Activity Chart",-1)])),_:1}),t(y),t(i,null,{default:l(()=>[v.value?(c(),_("div",Ee,[t(D,{color:"primary",size:"3em"}),e[13]||(e[13]=a("div",{class:"q-mt-sm"},"Loading chart...",-1))])):(c(),_("div",Ae,[a("canvas",{ref_key:"chartCanvas",ref:Y},null,512)]))]),_:1})]),_:1})]),a("div",Ne,[t(g,{flat:"",bordered:""},{default:l(()=>[t(i,null,{default:l(()=>e[14]||(e[14]=[a("div",{class:"text-h6"},"Document Type Breakdown",-1)])),_:1}),t(y),t(i,null,{default:l(()=>[v.value?(c(),_("div",Be,[t(D,{color:"primary",size:"3em"}),e[15]||(e[15]=a("div",{class:"q-mt-sm"},"Loading breakdown...",-1))])):(c(),_("div",je,[t(E,{rows:U.value,columns:O,"row-key":"template_name",dense:"",flat:"",pagination:{rowsPerPage:5}},{body:l(s=>[t(A,{props:s},{default:l(()=>[t(u,{key:"template_name",props:s},{default:l(()=>[m(d(s.row.template_name),1)]),_:2},1032,["props"]),t(u,{key:"count",props:s,class:"text-right"},{default:l(()=>[m(d(s.row.count),1)]),_:2},1032,["props"]),t(u,{key:"percentage",props:s,class:"text-right"},{default:l(()=>[m(d(s.row.percentage.toFixed(1))+"% ",1),t(de,{value:s.row.percentage/100,color:"primary",class:"q-mt-xs"},null,8,["value"])]),_:2},1032,["props"])]),_:2},1032,["props"])]),_:1},8,["rows"])]))]),_:1})]),_:1})]),a("div",Ie,[t(g,{flat:"",bordered:""},{default:l(()=>[t(i,null,{default:l(()=>e[16]||(e[16]=[a("div",{class:"text-h6"},"Recent Activity",-1)])),_:1}),t(y),t(i,null,{default:l(()=>[k.value?(c(),_("div",Le,[t(D,{color:"primary",size:"3em"}),e[17]||(e[17]=a("div",{class:"q-mt-sm"},"Loading activity...",-1))])):(c(),_("div",Ue,[t(E,{rows:R.value,columns:G,"row-key":"request_id",dense:"",flat:"",pagination:{rowsPerPage:10}},{body:l(s=>[t(A,{props:s},{default:l(()=>[t(u,{key:"request_reference",props:s},{default:l(()=>[m(d(s.row.request_reference),1)]),_:2},1032,["props"]),t(u,{key:"document_title",props:s},{default:l(()=>[m(d(s.row.document_title),1)]),_:2},1032,["props"]),t(u,{key:"user_name",props:s},{default:l(()=>[m(d(s.row.user_name),1)]),_:2},1032,["props"]),t(u,{key:"status",props:s},{default:l(()=>[t(ie,{color:s.row.status==="notarized"?"positive":"negative"},{default:l(()=>[m(d(s.row.status),1)]),_:2},1032,["color"])]),_:2},1032,["props"]),t(u,{key:"processed_at",props:s},{default:l(()=>[m(d($(s.row.processed_at)),1)]),_:2},1032,["props"]),t(u,{key:"actions",props:s},{default:l(()=>[t(V,{size:"sm",flat:"",round:"",color:"primary",icon:"visibility",onClick:M=>J(s.row.document_id)},{default:l(()=>[t(ce,null,{default:l(()=>e[18]||(e[18]=[m("View Document")])),_:1})]),_:2},1032,["onClick"])]),_:2},1032,["props"])]),_:2},1032,["props"])]),_:1},8,["rows"])]))]),_:1})]),_:1})])])]),_:1}))}});var tt=ee(Oe,[["__scopeId","data-v-d01520c2"]]);export{tt as default};
