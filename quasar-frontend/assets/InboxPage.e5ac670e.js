import{ax as me,ay as N,aA as k,_ as fe,d as ge,c as pe,e as ve,r as f,h as R,a8 as z,o as ye,j as i,k as g,w as a,az as _e,D as u,l,n as c,b4 as we,C as F,aJ as he,aM as j,B as P,aC as be,aD as T,t as w,aB as A,bu as D,v as Z,p as v,E as C,b5 as S,bv as De,s as Ce,G as E,aX as Se,aY as qe,R as I}from"./index.3c170ecb.js";import{Q as q}from"./QTooltip.195764a5.js";import{d as ke}from"./date.65b635a6.js";import{u as xe}from"./document.66d1496e.js";import{D as Pe}from"./DocumentStatusBadge.1113eb2f.js";import"./document.fb1f13b2.js";const Qe=me("documentStatus",{state:()=>({statuses:[],isLoading:!1,error:null}),getters:{activeStatuses:n=>n.statuses.filter(o=>o.is_active),statusOptions:n=>n.statuses.map(o=>({label:o.status_name,value:o.status_code})),getStatusById:n=>o=>n.statuses.find(d=>d.status_id===o)||null,getStatusByCode:n=>o=>n.statuses.find(d=>d.status_code===o)||null},actions:{async fetchDocumentStatuses(){this.isLoading=!0,this.error=null;try{const n=await N.get("/document-statuses");if(n.data.success)return this.statuses=n.data.data,this.statuses;throw this.error=n.data.message||"Failed to fetch document statuses",new Error(this.error)}catch(n){throw console.error("Error fetching document statuses:",n),this.error=n.message||"An error occurred while fetching document statuses",k.create({type:"negative",message:this.error}),n}finally{this.isLoading=!1}},async fetchDocumentStatus(n){this.isLoading=!0,this.error=null;try{const o=await N.get(`/document-statuses/${n}`);if(o.data.success)return o.data.data;throw this.error=o.data.message||"Failed to fetch document status",new Error(this.error)}catch(o){throw console.error(`Error fetching document status with ID ${n}:`,o),this.error=o.message||"An error occurred while fetching document status",o}finally{this.isLoading=!1}},async fetchDocumentStatusByCode(n){this.isLoading=!0,this.error=null;try{const o=await N.get(`/document-statuses/code/${n}`);if(o.data.success)return o.data.data;throw this.error=o.data.message||"Failed to fetch document status",new Error(this.error)}catch(o){throw console.error(`Error fetching document status with code ${n}:`,o),this.error=o.message||"An error occurred while fetching document status",o}finally{this.isLoading=!1}}}});const $e={class:"content-container q-pa-md q-pb-xl"},Le={class:"row items-center q-mb-md"},Ve={class:"col-auto"},Be={class:"row q-col-gutter-md q-mb-md"},Ne={class:"col-12 col-md-6"},Re={class:"col-12 col-md-3"},Fe={class:"col-12 col-md-3"},Te={key:0,class:"q-pa-xl flex flex-center"},Ae={class:"text-grey-8"},Ee={key:1},Ie={key:1},Me={class:"text-body2"},Ue={key:0,class:"text-caption text-grey-7"},Oe=ge({__name:"InboxPage",setup(n){const o=pe(),d=ve(),Q=xe(),$=Qe(),L=f([]),x=f(!0),V=f(!1),m=f(""),r=f(null),h=f("newest"),b=f(null),B=f(!1),p=f({sortBy:"created_at",descending:!0,page:1,rowsPerPage:10,rowsNumber:0}),G=[{name:"document_reference",required:!0,label:"Reference",align:"left",field:"document_reference",sortable:!0},{name:"document_title",required:!0,label:"Title",align:"left",field:"document_title",sortable:!0},{name:"template_name",label:"Template",align:"left",field:"template_name",sortable:!0},{name:"status",label:"Document Status",align:"center",field:"status",sortable:!0},{name:"request_status",label:"Request Status",align:"center",field:"request_status",sortable:!0},{name:"payment_status",label:"Payment Status",align:"center",field:"payment_status",sortable:!0},{name:"dates",label:"Dates",align:"left",sortable:!1},{name:"actions",label:"Actions",align:"center",sortable:!1}],M=R(()=>[{label:"All Statuses",value:null},...$.statusOptions]),J=[{label:"Newest First",value:"newest"},{label:"Oldest First",value:"oldest"},{label:"Title A-Z",value:"title_asc"},{label:"Title Z-A",value:"title_desc"}],U=R(()=>{console.log("Running filteredDocuments computed property"),console.log("Current status filter:",r.value),console.log("Available documents:",L.value);let t=[...L.value];switch(r.value?(console.log("Filtering by status:",r.value),t=t.filter(e=>{const s=e.status===r.value;return console.log(`Document ${e.document_id} status: ${e.status}, matches filter: ${s}`),s})):console.log("No status filter applied to documents"),h.value){case"newest":t.sort((e,s)=>new Date(s.created_at).getTime()-new Date(e.created_at).getTime());break;case"oldest":t.sort((e,s)=>new Date(e.created_at).getTime()-new Date(s.created_at).getTime());break;case"title_asc":t.sort((e,s)=>e.document_title.localeCompare(s.document_title));break;case"title_desc":t.sort((e,s)=>s.document_title.localeCompare(e.document_title));break}if(m.value){const e=m.value.toLowerCase();t=t.filter(s=>s.document_title.toLowerCase().includes(e)||s.document_reference.toLowerCase().includes(e)||s.template_name.toLowerCase().includes(e))}return console.log("Filtered documents result:",t.length,"documents"),t}),X=R(()=>{var t;return m.value?`No documents found matching "${m.value}".`:r.value?`You don't have any documents with status "${((t=M.value.find(s=>s.value===r.value))==null?void 0:t.label)||r.value}".`:"You have not created any documents yet. Click the button below to create your first document."}),H=t=>{if(console.log("Status changed to:",t),r.value=t,t===null){const e={...d.query};delete e.status,o.replace({query:e})}else o.replace({query:{...d.query,status:t}});y()},K=()=>{console.log("Status cleared"),r.value=null;const t={...d.query};delete t.status,o.replace({query:t}),y()},O=t=>t?ke.formatDate(new Date(t),"MMM D, YYYY"):"",W=t=>{switch(t){case"pending":return"orange";case"assigned":return"blue";case"notarized":return"positive";case"rejected":return"negative";default:return"grey"}},ee=t=>t?t.replace(/_/g," ").replace(/\b\w/g,e=>e.toUpperCase()):"",te=t=>{switch(t){case"pending":return"purple";case"completed":return"positive";case"failed":return"negative";default:return"grey"}},se=t=>t?t.replace(/_/g," ").replace(/\b\w/g,e=>e.toUpperCase()):"",ae=t=>t.status==="submitted"&&t.payment_status==="pending",y=async()=>{x.value=!0;try{const t={page:p.value.page,per_page:p.value.rowsPerPage};r.value!==null?(console.log("Adding status filter to request:",r.value),t.status=r.value):console.log("No status filter applied"),console.log("Fetching documents with params:",t);const e=await Q.fetchDocuments(t);e&&e.length>=0&&(console.log("Received documents:",e),L.value=e,p.value.rowsNumber=Q.totalDocuments||e.length)}catch(t){console.error("Error loading documents:",t),k.create({type:"negative",message:"Failed to load documents"})}finally{x.value=!1}},oe=t=>{const{page:e,rowsPerPage:s,sortBy:_,descending:de}=t.pagination;p.value.page=e,p.value.rowsPerPage=s,p.value.sortBy=_,p.value.descending=de,y()},le=(t,e)=>{Y(e)},Y=t=>{o.push(`/user/documents/${t.document_id}`)},ne=t=>{o.push(`/user/document/${t.document_id}/edit`)},re=t=>{o.push({path:"/user/payment",query:{request_id:t.request_id}})},ue=t=>{o.push(`/user/document/${t.document_id}/edit`)},ie=t=>{b.value=t,B.value=!0},ce=async()=>{if(!!b.value){V.value=!0;try{await Q.deleteDocument(b.value.document_id),k.create({type:"positive",message:"Document deleted successfully"}),y()}catch(t){console.error("Error deleting document:",t),k.create({type:"negative",message:"Failed to delete document"})}finally{V.value=!1,b.value=null}}};return z(r,t=>{console.log("Status filter changed in watcher:",t)},{immediate:!0}),z(h,()=>{console.log("Sort option changed:",h.value),y()}),ye(async()=>{console.log("Component mounted, loading statuses and documents");try{await $.fetchDocumentStatuses(),console.log("Document statuses loaded:",$.statusOptions),d.query.status?(r.value=String(d.query.status),console.log("Initial status from URL:",r.value)):(r.value=null,console.log("No initial status in URL, setting to null")),await y()}catch(t){console.error("Error during initialization:",t),k.create({type:"negative",message:"Failed to initialize document view"})}}),(t,e)=>(i(),g(_e,{class:"inbox-page bg-grey-1"},{default:a(()=>[u("div",$e,[u("div",Le,[e[5]||(e[5]=u("div",{class:"col"},[u("h1",{class:"text-h5 q-my-none"},"My Documents"),u("p",{class:"text-grey-8 q-mb-none"}," Manage your documents and track their status ")],-1)),u("div",Ve,[l(c,{unelevated:"",color:"primary",label:"New Document",icon:"fa-solid fa-plus","no-caps":"",to:"/user/template-selection"})])]),u("div",Be,[u("div",Ne,[l(he,{modelValue:m.value,"onUpdate:modelValue":e[1]||(e[1]=s=>m.value=s),dense:"",outlined:"",placeholder:"Search documents",class:"full-width"},we({prepend:a(()=>[l(F,{name:"fa-solid fa-search"})]),_:2},[m.value?{name:"append",fn:a(()=>[l(F,{name:"fa-solid fa-times",class:"cursor-pointer",onClick:e[0]||(e[0]=s=>m.value="")})]),key:"0"}:void 0]),1032,["modelValue"])]),u("div",Re,[l(j,{modelValue:r.value,"onUpdate:modelValue":e[2]||(e[2]=s=>r.value=s),options:M.value,outlined:"",dense:"",label:"Status","emit-value":"","map-options":"",clearable:"","options-dense":"",class:"full-width",onInput:H,onClear:K},null,8,["modelValue","options"])]),u("div",Fe,[l(j,{modelValue:h.value,"onUpdate:modelValue":e[3]||(e[3]=s=>h.value=s),options:J,outlined:"",dense:"",label:"Sort By","emit-value":"","map-options":"","options-dense":"",class:"full-width"},null,8,["modelValue"])])]),x.value?(i(),P("div",Te,[l(be,{color:"primary",size:"3em"}),e[6]||(e[6]=u("span",{class:"q-ml-sm text-primary"},"Loading documents...",-1))])):U.value.length===0?(i(),g(T,{key:1,flat:"",class:"bg-white"},{default:a(()=>[l(A,{class:"text-center q-pa-xl"},{default:a(()=>[l(F,{name:"fa-solid fa-folder-open",size:"3em",color:"grey-6"}),e[7]||(e[7]=u("div",{class:"text-h6 q-mt-md"},"No Documents Found",-1)),u("p",Ae,w(X.value),1),l(c,{unelevated:"",color:"primary",label:"Create New Document",icon:"fa-solid fa-plus","no-caps":"",class:"q-mt-sm",to:"/user/template-selection"})]),_:1})]),_:1})):(i(),g(T,{key:2,flat:"",class:"bg-white"},{default:a(()=>[l(De,{rows:U.value,columns:G,"row-key":"document_id",pagination:p.value,loading:x.value,"rows-per-page-options":[10,20,50],onRequest:oe,onRowClick:le,class:"document-table","no-data-label":"No documents found",filter:m.value},{"body-cell-status":a(s=>[l(D,{props:s},{default:a(()=>[l(Pe,{status:s.row.status,"status-id":s.row.status_id,"status-name":s.row.status_name},null,8,["status","status-id","status-name"])]),_:2},1032,["props"])]),"body-cell-request_status":a(s=>[l(D,{props:s},{default:a(()=>[s.row.request_status?(i(),g(Z,{key:0,color:W(s.row.request_status)},{default:a(()=>[v(w(ee(s.row.request_status)),1)]),_:2},1032,["color"])):(i(),P("span",Ee,"-"))]),_:2},1032,["props"])]),"body-cell-payment_status":a(s=>[l(D,{props:s},{default:a(()=>[s.row.payment_status?(i(),g(Z,{key:0,color:te(s.row.payment_status)},{default:a(()=>[v(w(se(s.row.payment_status)),1)]),_:2},1032,["color"])):(i(),P("span",Ie,"-"))]),_:2},1032,["props"])]),"body-cell-dates":a(s=>[l(D,{props:s},{default:a(()=>[u("div",Me," Created: "+w(O(s.row.created_at)),1),s.row.submitted_at?(i(),P("div",Ue," Submitted: "+w(O(s.row.submitted_at)),1)):C("",!0)]),_:2},1032,["props"])]),"body-cell-actions":a(s=>[l(D,{props:s,class:"q-gutter-x-sm"},{default:a(()=>[l(c,{flat:"",round:"",dense:"",color:"primary",icon:"fa-solid fa-eye",onClick:S(_=>Y(s.row),["stop"])},{default:a(()=>[l(q,null,{default:a(()=>e[8]||(e[8]=[v("View Details")])),_:1})]),_:2},1032,["onClick"]),s.row.status==="draft"?(i(),g(c,{key:0,flat:"",round:"",dense:"",color:"primary",icon:"fa-solid fa-pencil",onClick:S(_=>ne(s.row),["stop"])},{default:a(()=>[l(q,null,{default:a(()=>e[9]||(e[9]=[v("Edit Document")])),_:1})]),_:2},1032,["onClick"])):C("",!0),s.row.status==="draft"?(i(),g(c,{key:1,flat:"",round:"",dense:"",color:"negative",icon:"fa-solid fa-trash-alt",onClick:S(_=>ie(s.row),["stop"])},{default:a(()=>[l(q,null,{default:a(()=>e[10]||(e[10]=[v("Delete Document")])),_:1})]),_:2},1032,["onClick"])):C("",!0),ae(s.row)?(i(),g(c,{key:2,flat:"",round:"",dense:"",color:"purple",icon:"fa-solid fa-credit-card",onClick:S(_=>re(s.row),["stop"])},{default:a(()=>[l(q,null,{default:a(()=>e[11]||(e[11]=[v("Continue Payment")])),_:1})]),_:2},1032,["onClick"])):C("",!0),s.row.status==="rejected"?(i(),g(c,{key:3,flat:"",round:"",dense:"",color:"orange",icon:"fa-solid fa-redo",onClick:S(_=>ue(s.row),["stop"])},{default:a(()=>[l(q,null,{default:a(()=>e[12]||(e[12]=[v("Modify & Resubmit")])),_:1})]),_:2},1032,["onClick"])):C("",!0)]),_:2},1032,["props"])]),_:1},8,["rows","pagination","loading","filter"])]),_:1}))]),l(qe,{modelValue:B.value,"onUpdate:modelValue":e[4]||(e[4]=s=>B.value=s),persistent:""},{default:a(()=>[l(T,{style:{"min-width":"350px"}},{default:a(()=>[l(A,{class:"row items-center"},{default:a(()=>[e[13]||(e[13]=u("div",{class:"text-h6"},"Delete Document",-1)),l(Ce),E(l(c,{icon:"fa-solid fa-times",flat:"",round:"",dense:""},null,512),[[I]])]),_:1}),l(A,null,{default:a(()=>{var s;return[u("p",null,' Are you sure you want to delete document "'+w((s=b.value)==null?void 0:s.document_title)+'"? ',1),e[14]||(e[14]=u("p",{class:"text-caption text-grey-8"},"This action cannot be undone.",-1))]}),_:1}),l(Se,{align:"right"},{default:a(()=>[E(l(c,{flat:"",label:"Cancel",color:"primary"},null,512),[[I]]),E(l(c,{unelevated:"",label:"Delete",color:"negative",onClick:ce,loading:V.value},null,8,["loading"]),[[I]])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1}))}});var Xe=fe(Oe,[["__scopeId","data-v-487c8ea8"]]);export{Xe as default};
