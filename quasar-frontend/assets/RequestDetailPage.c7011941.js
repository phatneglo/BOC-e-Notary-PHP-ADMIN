import{_ as be,d as we,e as qe,c as De,h as xe,r as i,o as Ve,j as g,k as N,w as a,az as ke,aA as b,D as o,l as e,n as d,B as k,aC as ae,aD as q,C as c,aB as f,H as _,I as n,z as u,p as r,t as y,v as le,E as Re,A as oe,y as Ce,J as Se,F as Pe,aI as se,aJ as R,aM as he,aX as $,s as J,G as P,aY as O,R as h}from"./index.3c170ecb.js";import{Q as ne}from"./QTooltip.195764a5.js";import{d as Qe}from"./date.65b635a6.js";import{u as Fe}from"./notary.66e50f09.js";import{u as je}from"./document.66d1496e.js";import{D as re}from"./DocumentPreviewComponent.15f7d0bf.js";import{D as Be}from"./DocumentStatusBadge.1113eb2f.js";import"./document.fb1f13b2.js";const ze={class:"content-container q-pa-md"},Ae={class:"row items-center q-mb-md"},Ne={class:"col-auto"},Ie={key:0,class:"q-pa-xl flex flex-center"},Ue={key:2},Me={class:"row q-col-gutter-md"},Te={class:"col-12 col-md-4"},Le={class:"row q-col-gutter-md"},Ee={class:"col-12"},Ye={class:"col-12"},Ge={class:"col-12"},$e={class:"col-12"},Je={class:"col-12"},Oe={class:"col-12"},He={class:"col-12"},Ke={class:"col-12"},Xe={key:0,class:"col-12"},We={key:0,class:"q-pa-md text-center"},Ze={key:1,class:"q-pa-md text-center text-grey-8"},et={class:"col-12 col-md-8"},tt={class:"row q-col-gutter-md"},at={class:"col-12"},lt={class:"col-12"},ot={class:"row q-col-gutter-md"},st={class:"col-12 col-md-6"},nt={class:"col-12 col-md-6"},rt={class:"text-center q-pa-md q-mb-md bg-grey-2 rounded-borders"},ut={class:"text-center q-pa-md q-mb-md bg-grey-2 rounded-borders"},it=we({__name:"RequestDetailPage",setup(dt){const H=qe(),I=De(),Q=xe(()=>H.params.id?parseInt(H.params.id):null),w=i(null),D=Fe(),ue=je(),U=i(!0),M=i(!1),F=i(!1),v=i(!1),p=i(null),x=i(null),T=i([]),j=i(""),B=i(""),z=i(!1),L=i(!1),A=i(!1),C=i(!1),E=i(""),S=i(null),Y=i(null),m=i({document_number:"",page_number:1,book_number:"",series_of:new Date().getFullYear().toString(),notary_location:"",certificate_type:"acknowledgment"}),ie=[{label:"Acknowledgment",value:"acknowledgment"},{label:"Jurat",value:"jurat"},{label:"Certification",value:"certification"},{label:"Oath or Affirmation",value:"oath"},{label:"Copy Certification",value:"copy"}],de=s=>s?Qe.formatDate(new Date(s),"MMM D, YYYY h:mm A"):"",me=s=>{if(!s)return"0 B";const t=1024,l=["B","KB","MB","GB","TB"],V=Math.floor(Math.log(s)/Math.log(t));return parseFloat((s/Math.pow(t,V)).toFixed(2))+" "+l[V]},ce=s=>{switch(s){case"pending":return"orange";case"assigned":return"blue";case"notarized":return"positive";case"rejected":return"negative";default:return"grey"}},fe=s=>{switch(s){case"pending":return"purple";case"paid":return"positive";case"failed":return"negative";default:return"grey"}},K=s=>s?s.replace(/_/g," ").replace(/\b\w/g,t=>t.toUpperCase()):"",ve=async()=>{if(!Q.value){b.create({type:"negative",message:"Invalid request ID"}),I.push("/notary/inbox");return}U.value=!0;try{const s=await D.getRequestDetails(Q.value);s&&(p.value=s,w.value=s.document_id,w.value&&await pe(w.value))}catch(s){console.error("Error loading request details:",s),b.create({type:"negative",message:"Failed to load request details"})}finally{U.value=!1}},pe=async s=>{try{const t=await ue.fetchDocument(s);t&&(x.value=t,await ge(s),await G())}catch(t){console.error("Error loading document details:",t),b.create({type:"negative",message:"Failed to load document details"})}},ge=async s=>{M.value=!0;try{const t=await D.getDocumentAttachments(s);t&&(T.value=t)}catch(t){console.error("Error loading attachments:",t),b.create({type:"negative",message:"Failed to load document attachments"})}finally{M.value=!1}},G=async()=>{if(!!w.value){F.value=!0;try{const s=await D.generateDocumentPreview(w.value);s&&(s.format==="pdf"?(B.value=s.render_url,j.value="",z.value=!0):(j.value=s.html_content,B.value="",z.value=!1))}catch(s){console.error("Error generating preview:",s),b.create({type:"negative",message:"Failed to generate document preview"})}finally{F.value=!1}}},_e=s=>{window.open(`/documents/attachments/${s.attachment_id}/view`,"_blank")},X=()=>{L.value=!0},W=s=>{window.open(`/documents/${s}/download`,"_blank")},ye=()=>{S.value?S.value.validate().then(s=>{s&&(C.value=!0)}):C.value=!0},Z=async()=>{if(!(!S.value||!await S.value.validate())){v.value=!0;try{await D.approveRequest(Q.value,m.value)&&(b.create({type:"positive",message:"Document approved successfully"}),C.value=!1,I.push("/notary/processed"))}catch(t){console.error("Error approving document:",t),b.create({type:"negative",message:"Failed to approve document"})}finally{v.value=!1}}},ee=async()=>{if(!(!Y.value||!await Y.value.validate())){v.value=!0;try{await D.rejectRequest(Q.value,{rejection_reason:E.value})&&(b.create({type:"positive",message:"Document rejected"}),A.value=!1,I.push("/notary/inbox"))}catch(t){console.error("Error rejecting document:",t),b.create({type:"negative",message:"Failed to reject document"})}finally{v.value=!1}}};return Ve(()=>{D.getNotaryProfile().then(s=>{s&&(m.value.notary_location=s.location||"")}),ve()}),(s,t)=>(g(),N(ke,{class:"request-detail-page bg-grey-1"},{default:a(()=>[o("div",ze,[o("div",Ae,[t[11]||(t[11]=o("div",{class:"col"},[o("h1",{class:"text-h5 q-my-none"},"Notarization Request Review"),o("p",{class:"text-grey-8 q-mb-none"}," Review request details and approve or reject the notarization ")],-1)),o("div",Ne,[e(d,{outline:"",color:"primary",label:"Back to Queue",icon:"fa-solid fa-arrow-left","no-caps":"",to:"/notary/inbox"})])]),U.value?(g(),k("div",Ie,[e(ae,{color:"primary",size:"3em"}),t[12]||(t[12]=o("span",{class:"q-ml-sm text-primary"},"Loading request details...",-1))])):p.value?(g(),k("div",Ue,[o("div",Me,[o("div",Te,[e(q,{flat:"",class:"bg-white"},{default:a(()=>[e(f,null,{default:a(()=>t[15]||(t[15]=[o("div",{class:"text-h6"},"Request Information",-1)])),_:1}),e(f,null,{default:a(()=>[o("div",Le,[o("div",Ee,[e(_,null,{default:a(()=>[e(n,{avatar:""},{default:a(()=>[e(c,{name:"fa-solid fa-hashtag",color:"primary"})]),_:1}),e(n,null,{default:a(()=>[e(u,{caption:""},{default:a(()=>t[16]||(t[16]=[r("Request Reference")])),_:1}),e(u,null,{default:a(()=>[r(y(p.value.request_reference),1)]),_:1})]),_:1})]),_:1})]),o("div",Ye,[e(_,null,{default:a(()=>[e(n,{avatar:""},{default:a(()=>[e(c,{name:"fa-solid fa-file-alt",color:"primary"})]),_:1}),e(n,null,{default:a(()=>[e(u,{caption:""},{default:a(()=>t[17]||(t[17]=[r("Document Title")])),_:1}),e(u,null,{default:a(()=>{var l;return[r(y(p.value.document_title||((l=x.value)==null?void 0:l.document_title)),1)]}),_:1})]),_:1})]),_:1})]),o("div",Ge,[e(_,null,{default:a(()=>[e(n,{avatar:""},{default:a(()=>[e(c,{name:"fa-solid fa-info-circle",color:"primary"})]),_:1}),e(n,null,{default:a(()=>[e(u,{caption:""},{default:a(()=>t[18]||(t[18]=[r("Request Status")])),_:1}),e(u,null,{default:a(()=>[e(le,{color:ce(p.value.status)},{default:a(()=>[r(y(K(p.value.status)),1)]),_:1},8,["color"])]),_:1})]),_:1})]),_:1})]),o("div",$e,[e(_,null,{default:a(()=>[e(n,{avatar:""},{default:a(()=>[e(c,{name:"fa-solid fa-file-signature",color:"primary"})]),_:1}),e(n,null,{default:a(()=>[e(u,{caption:""},{default:a(()=>t[19]||(t[19]=[r("Document Status")])),_:1}),e(u,null,{default:a(()=>{var l,V,te;return[e(Be,{status:(l=x.value)==null?void 0:l.status,"status-id":(V=x.value)==null?void 0:V.status_id,"status-name":(te=x.value)==null?void 0:te.status_name},null,8,["status","status-id","status-name"])]}),_:1})]),_:1})]),_:1})]),o("div",Je,[e(_,null,{default:a(()=>[e(n,{avatar:""},{default:a(()=>[e(c,{name:"fa-solid fa-user",color:"primary"})]),_:1}),e(n,null,{default:a(()=>[e(u,{caption:""},{default:a(()=>t[20]||(t[20]=[r("Requested By")])),_:1}),e(u,null,{default:a(()=>[r(y(p.value.requester_name||"Unknown"),1)]),_:1})]),_:1})]),_:1})]),o("div",Oe,[e(_,null,{default:a(()=>[e(n,{avatar:""},{default:a(()=>[e(c,{name:"fa-solid fa-calendar",color:"primary"})]),_:1}),e(n,null,{default:a(()=>[e(u,{caption:""},{default:a(()=>t[21]||(t[21]=[r("Requested At")])),_:1}),e(u,null,{default:a(()=>[r(y(de(p.value.requested_at)),1)]),_:1})]),_:1})]),_:1})]),o("div",He,[e(_,null,{default:a(()=>[e(n,{avatar:""},{default:a(()=>[e(c,{name:"fa-solid fa-file-invoice",color:"primary"})]),_:1}),e(n,null,{default:a(()=>[e(u,{caption:""},{default:a(()=>t[22]||(t[22]=[r("Template")])),_:1}),e(u,null,{default:a(()=>{var l;return[r(y(((l=x.value)==null?void 0:l.template_name)||"Custom Document"),1)]}),_:1})]),_:1})]),_:1})]),o("div",Ke,[e(_,null,{default:a(()=>[e(n,{avatar:""},{default:a(()=>[e(c,{name:"fa-solid fa-credit-card",color:"primary"})]),_:1}),e(n,null,{default:a(()=>[e(u,{caption:""},{default:a(()=>t[23]||(t[23]=[r("Payment Status")])),_:1}),e(u,null,{default:a(()=>[e(le,{color:fe(p.value.payment_status)},{default:a(()=>[r(y(K(p.value.payment_status)),1)]),_:1},8,["color"])]),_:1})]),_:1})]),_:1})]),p.value.queue_position?(g(),k("div",Xe,[e(_,null,{default:a(()=>[e(n,{avatar:""},{default:a(()=>[e(c,{name:"fa-solid fa-sort-numeric-down",color:"primary"})]),_:1}),e(n,null,{default:a(()=>[e(u,{caption:""},{default:a(()=>t[24]||(t[24]=[r("Queue Position")])),_:1}),e(u,null,{default:a(()=>[r(y(p.value.queue_position),1)]),_:1})]),_:1})]),_:1})])):Re("",!0)])]),_:1}),e(oe),e(f,null,{default:a(()=>[t[28]||(t[28]=o("div",{class:"text-h6"},"Supporting Documents",-1)),M.value?(g(),k("div",We,[e(ae,{color:"primary",size:"2em"}),t[25]||(t[25]=o("div",{class:"q-mt-sm"},"Loading attachments...",-1))])):T.value.length===0?(g(),k("div",Ze,[e(c,{name:"fa-solid fa-file-circle-exclamation",size:"2em"}),t[26]||(t[26]=o("div",{class:"q-mt-sm"},"No supporting documents attached",-1))])):(g(),N(Ce,{key:2,bordered:"",separator:"",class:"q-mt-md"},{default:a(()=>[(g(!0),k(Se,null,Pe(T.value,l=>(g(),N(_,{key:l.attachment_id,clickable:"",onClick:V=>_e(l)},{default:a(()=>[e(n,{avatar:""},{default:a(()=>[e(c,{name:"fa-solid fa-file",color:"primary"})]),_:1}),e(n,null,{default:a(()=>[e(u,null,{default:a(()=>[r(y(l.file_name),1)]),_:2},1024),e(u,{caption:""},{default:a(()=>[r(y(me(l.file_size)),1)]),_:2},1024)]),_:2},1024),e(n,{side:""},{default:a(()=>[e(d,{flat:"",round:"",icon:"fa-solid fa-eye",color:"primary"},{default:a(()=>[e(ne,null,{default:a(()=>t[27]||(t[27]=[r("View Document")])),_:1})]),_:1})]),_:1})]),_:2},1032,["onClick"]))),128))]),_:1}))]),_:1})]),_:1})]),o("div",et,[o("div",tt,[o("div",at,[e(q,{flat:"",class:"bg-white"},{default:a(()=>[e(f,{class:"q-pb-none"},{default:a(()=>[t[30]||(t[30]=o("div",{class:"text-h6"},"Document Preview",-1)),e(d,{flat:"",round:"",color:"primary",icon:"fa-solid fa-expand",class:"float-right",onClick:X},{default:a(()=>[e(ne,null,{default:a(()=>t[29]||(t[29]=[r("Fullscreen Preview")])),_:1})]),_:1})]),_:1}),e(f,{class:"document-preview-container"},{default:a(()=>[e(re,{loading:F.value,"preview-html":j.value,"preview-url":B.value,"is-pdf-preview":z.value,"document-id":w.value,onGenerate:G,onFullscreen:X,onDownload:W},null,8,["loading","preview-html","preview-url","is-pdf-preview","document-id"])]),_:1})]),_:1})]),o("div",lt,[e(q,{flat:"",class:"bg-white"},{default:a(()=>[e(f,null,{default:a(()=>t[31]||(t[31]=[o("div",{class:"text-h6"},"Notary Actions",-1)])),_:1}),e(f,null,{default:a(()=>[o("div",ot,[o("div",st,[t[32]||(t[32]=o("div",{class:"text-subtitle2 q-mb-sm"},"Notarization Details",-1)),e(se,{onSubmit:Z,ref_key:"approvalForm",ref:S},{default:a(()=>[e(R,{modelValue:m.value.document_number,"onUpdate:modelValue":t[0]||(t[0]=l=>m.value.document_number=l),label:"Document Number *",outlined:"",dense:"",class:"q-mb-sm",rules:[l=>!!l||"Document number is required"]},null,8,["modelValue","rules"]),e(R,{modelValue:m.value.page_number,"onUpdate:modelValue":t[1]||(t[1]=l=>m.value.page_number=l),label:"Page Number *",outlined:"",dense:"",type:"number",class:"q-mb-sm",rules:[l=>!!l||"Page number is required"]},null,8,["modelValue","rules"]),e(R,{modelValue:m.value.book_number,"onUpdate:modelValue":t[2]||(t[2]=l=>m.value.book_number=l),label:"Book Number *",outlined:"",dense:"",class:"q-mb-sm",rules:[l=>!!l||"Book number is required"]},null,8,["modelValue","rules"]),e(R,{modelValue:m.value.series_of,"onUpdate:modelValue":t[3]||(t[3]=l=>m.value.series_of=l),label:"Series Of *",outlined:"",dense:"",class:"q-mb-sm",rules:[l=>!!l||"Series is required"]},null,8,["modelValue","rules"]),e(R,{modelValue:m.value.notary_location,"onUpdate:modelValue":t[4]||(t[4]=l=>m.value.notary_location=l),label:"Location *",outlined:"",dense:"",class:"q-mb-sm",rules:[l=>!!l||"Location is required"]},null,8,["modelValue","rules"]),e(he,{modelValue:m.value.certificate_type,"onUpdate:modelValue":t[5]||(t[5]=l=>m.value.certificate_type=l),options:ie,label:"Certificate Type *",outlined:"",dense:"","emit-value":"","map-options":"",class:"q-mb-sm",rules:[l=>!!l||"Certificate type is required"]},null,8,["modelValue","rules"])]),_:1},512)]),o("div",nt,[t[35]||(t[35]=o("div",{class:"text-subtitle2 q-mb-sm"},"Digital Signature & Seal",-1)),o("div",rt,[e(c,{name:"fa-solid fa-signature",size:"2rem",color:"primary"}),t[33]||(t[33]=o("div",{class:"q-mt-sm"},"Your digital signature will be applied",-1)),e(d,{flat:"",color:"primary",label:"Manage Signature","no-caps":"",class:"q-mt-sm",to:"/notary/profile"})]),o("div",ut,[e(c,{name:"fa-solid fa-stamp",size:"2rem",color:"primary"}),t[34]||(t[34]=o("div",{class:"q-mt-sm"},"Your digital seal will be applied",-1)),e(d,{flat:"",color:"primary",label:"Manage Seal","no-caps":"",class:"q-mt-sm",to:"/notary/profile"})])])])]),_:1}),e(oe),e($,{align:"right",class:"q-pa-md"},{default:a(()=>[e(d,{outline:"",color:"negative",icon:"fa-solid fa-times",label:"Reject Document","no-caps":"",onClick:t[6]||(t[6]=l=>A.value=!0),disable:v.value},null,8,["disable"]),e(d,{unelevated:"",color:"positive",icon:"fa-solid fa-check",label:"Approve Document","no-caps":"",onClick:ye,disable:v.value,loading:v.value},null,8,["disable","loading"])]),_:1})]),_:1})])])])])])):(g(),N(q,{key:1,flat:"",class:"bg-white"},{default:a(()=>[e(f,{class:"text-center q-pa-xl"},{default:a(()=>[e(c,{name:"fa-solid fa-file-circle-exclamation",size:"3em",color:"grey-6"}),t[13]||(t[13]=o("div",{class:"text-h6 q-mt-md"},"Request Not Found",-1)),t[14]||(t[14]=o("p",{class:"text-grey-8"}," The notarization request could not be found or has been processed. ",-1)),e(d,{unelevated:"",color:"primary",label:"Return to Queue",icon:"fa-solid fa-list","no-caps":"",class:"q-mt-sm",to:"/notary/inbox"})]),_:1})]),_:1}))]),e(O,{modelValue:L.value,"onUpdate:modelValue":t[7]||(t[7]=l=>L.value=l),maximized:"",persistent:""},{default:a(()=>[e(q,null,{default:a(()=>[e(f,{class:"row items-center q-py-sm bg-primary text-white"},{default:a(()=>[t[36]||(t[36]=o("div",{class:"text-h6"},"Document Preview",-1)),e(J),P(e(d,{icon:"fa-solid fa-times",flat:"",round:"",dense:""},null,512),[[h]])]),_:1}),e(f,{class:"full-preview-container"},{default:a(()=>[e(re,{loading:F.value,"preview-html":j.value,"preview-url":B.value,"is-pdf-preview":z.value,"document-id":w.value,onGenerate:G,onDownload:W},null,8,["loading","preview-html","preview-url","is-pdf-preview","document-id"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),e(O,{modelValue:A.value,"onUpdate:modelValue":t[9]||(t[9]=l=>A.value=l),persistent:""},{default:a(()=>[e(q,{style:{"min-width":"400px"}},{default:a(()=>[e(f,{class:"row items-center q-pb-none"},{default:a(()=>[t[37]||(t[37]=o("div",{class:"text-h6"},"Reject Document",-1)),e(J),P(e(d,{icon:"fa-solid fa-times",flat:"",round:"",dense:""},null,512),[[h]])]),_:1}),e(f,null,{default:a(()=>[e(se,{onSubmit:ee,ref_key:"rejectForm",ref:Y},{default:a(()=>[t[38]||(t[38]=o("p",{class:"text-body1"}," Please provide a reason for rejecting this document. This will be sent to the requester. ",-1)),e(R,{modelValue:E.value,"onUpdate:modelValue":t[8]||(t[8]=l=>E.value=l),label:"Rejection Reason *",filled:"",type:"textarea",rows:"4",class:"q-mb-md",rules:[l=>!!l&&l.length>=10||"Please provide a detailed rejection reason (min. 10 characters)"]},null,8,["modelValue","rules"])]),_:1},512)]),_:1}),e($,{align:"right",class:"q-pa-md"},{default:a(()=>[P(e(d,{flat:"",label:"Cancel",color:"primary",disable:v.value},null,8,["disable"]),[[h]]),e(d,{unelevated:"",label:"Reject Document",color:"negative",onClick:ee,loading:v.value,disable:v.value},null,8,["loading","disable"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),e(O,{modelValue:C.value,"onUpdate:modelValue":t[10]||(t[10]=l=>C.value=l),persistent:""},{default:a(()=>[e(q,{style:{"min-width":"400px"}},{default:a(()=>[e(f,{class:"row items-center q-pb-none"},{default:a(()=>[t[39]||(t[39]=o("div",{class:"text-h6"},"Confirm Approval",-1)),e(J),P(e(d,{icon:"fa-solid fa-times",flat:"",round:"",dense:""},null,512),[[h]])]),_:1}),e(f,null,{default:a(()=>t[40]||(t[40]=[o("p",{class:"text-body1"}," Are you sure you want to approve this document? This action cannot be undone. ",-1),o("p",{class:"text-caption text-grey-8"}," By approving, you confirm that you have reviewed the document and its supporting materials and that it meets all requirements for notarization. ",-1)])),_:1}),e($,{align:"right",class:"q-pa-md"},{default:a(()=>[P(e(d,{flat:"",label:"Cancel",color:"primary",disable:v.value},null,8,["disable"]),[[h]]),e(d,{unelevated:"",label:"Approve Document",color:"positive",onClick:Z,loading:v.value,disable:v.value},null,8,["loading","disable"])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1}))}});var bt=be(it,[["__scopeId","data-v-46fa801c"]]);export{bt as default};
