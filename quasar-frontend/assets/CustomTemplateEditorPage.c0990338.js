import{U as Ue,aQ as He,aR as Ie,h as I,ag as B,ak as Se,ai as Qe,bb as ct,bc as mt,bd as tt,be as Ye,p as A,J as U,E as R,I as ne,L as Ne,bf as pt,bg as ft,bh as vt,bi as ht,r as S,w as de,o as ze,a9 as gt,al as yt,b4 as lt,bj as _t,d as Me,f as Re,j as _,D as E,F as m,m as t,l as s,aF as bt,C as De,aH as kt,aZ as Te,aG as Oe,aI as Ae,aD as le,aB as W,K as ce,G as me,t as z,x as _e,q as H,k as D,b6 as Je,bk as wt,aL as Ge,y as at,s as X,A as Pe,H as J,B as ae,aK as j,aN as qe,bl as Xe,b0 as Le,aY as Fe,_ as je,S as G,g as xt,M as Ct,e as qt,c as St,aX as Tt,az as Ft,b3 as $t}from"./index.a0f63ec5.js";import{u as Dt}from"./template.67eedb40.js";import{u as Pt}from"./templateSection.356fbd64.js";import{Q as Ee}from"./QTooltip.a38b0b75.js";import{d as Et}from"./date.33ab5469.js";import{F as Ze}from"./feeSchedule.fcd7b639.js";import"./axios.089a157e.js";var zt=Ue({name:"QBar",props:{...He,dense:Boolean},setup(l,{slots:e}){const{proxy:{$q:n}}=Qe(),d=Ie(l,n),f=I(()=>`q-bar row no-wrap items-center q-bar--${l.dense===!0?"dense":"standard"}  q-bar--${d.value===!0?"dark":"light"}`);return()=>B("div",{class:f.value,role:"toolbar"},Se(e.default))}});function ot(l,e){if(e&&l===e)return null;const n=l.nodeName.toLowerCase();if(["div","li","ul","ol","blockquote"].includes(n)===!0)return l;const d=window.getComputedStyle?window.getComputedStyle(l):l.currentStyle,f=d.display;return f==="block"||f==="table"?l:ot(l.parentNode)}function Be(l,e,n){return!l||l===document.body?!1:n===!0&&l===e||(e===document?document.body:e).contains(l.parentNode)}function nt(l,e,n){if(n||(n=document.createRange(),n.selectNode(l),n.setStart(l,0)),e.count===0)n.setEnd(l,e.count);else if(e.count>0)if(l.nodeType===Node.TEXT_NODE)l.textContent.length<e.count?e.count-=l.textContent.length:(n.setEnd(l,e.count),e.count=0);else for(let d=0;e.count!==0&&d<l.childNodes.length;d++)n=nt(l.childNodes[d],e,n);return n}const Ot=/^https?:\/\//;class At{constructor(e,n){this.el=e,this.eVm=n,this._range=null}get selection(){if(this.el){const e=document.getSelection();if(Be(e.anchorNode,this.el,!0)&&Be(e.focusNode,this.el,!0))return e}return null}get hasSelection(){return this.selection!==null?this.selection.toString().length!==0:!1}get range(){const e=this.selection;return e!=null&&e.rangeCount?e.getRangeAt(0):this._range}get parent(){const e=this.range;if(e!==null){const n=e.startContainer;return n.nodeType===document.ELEMENT_NODE?n:n.parentNode}return null}get blockParent(){const e=this.parent;return e!==null?ot(e,this.el):null}save(e=this.range){e!==null&&(this._range=e)}restore(e=this._range){const n=document.createRange(),d=document.getSelection();e!==null?(n.setStart(e.startContainer,e.startOffset),n.setEnd(e.endContainer,e.endOffset),d.removeAllRanges(),d.addRange(n)):(d.selectAllChildren(this.el),d.collapseToEnd())}savePosition(){let e=-1,n;const d=document.getSelection(),f=this.el.parentNode;if(d.focusNode&&Be(d.focusNode,f))for(n=d.focusNode,e=d.focusOffset;n&&n!==f;)n!==this.el&&n.previousSibling?(n=n.previousSibling,e+=n.textContent.length):n=n.parentNode;this.savedPos=e}restorePosition(e=0){if(this.savedPos>0&&this.savedPos<e){const n=window.getSelection(),d=nt(this.el,{count:this.savedPos});d&&(d.collapse(!1),n.removeAllRanges(),n.addRange(d))}}hasParent(e,n){const d=n?this.parent:this.blockParent;return d!==null?d.nodeName.toLowerCase()===e.toLowerCase():!1}hasParents(e,n,d=this.parent){return d===null?!1:e.includes(d.nodeName.toLowerCase())===!0?!0:n===!0?this.hasParents(e,n,d.parentNode):!1}is(e,n){if(this.selection===null)return!1;switch(e){case"formatBlock":return n==="DIV"&&this.parent===this.el||this.hasParent(n,n==="PRE");case"link":return this.hasParent("A",!0);case"fontSize":return document.queryCommandValue(e)===n;case"fontName":const d=document.queryCommandValue(e);return d===`"${n}"`||d===n;case"fullscreen":return this.eVm.inFullscreen.value;case"viewsource":return this.eVm.isViewingSource.value;case void 0:return!1;default:const f=document.queryCommandState(e);return n!==void 0?f===n:f}}getParentAttribute(e){return this.parent!==null?this.parent.getAttribute(e):null}can(e){if(e==="outdent")return this.hasParents(["blockquote","li"],!0);if(e==="indent")return this.hasParents(["li"],!0);if(e==="link")return this.selection!==null||this.is("link")}apply(e,n,d=ct){if(e==="formatBlock")["BLOCKQUOTE","H1","H2","H3","H4","H5","H6"].includes(n)&&this.is(e,n)&&(e="outdent",n=null),n==="PRE"&&this.is(e,"PRE")&&(n="P");else if(e==="print"){d();const f=window.open();f.document.write(`
        <!doctype html>
        <html>
          <head>
            <title>Print - ${document.title}</title>
          </head>
          <body>
            <div>${this.el.innerHTML}</div>
          </body>
        </html>
      `),f.print(),f.close();return}else if(e==="link"){const f=this.getParentAttribute("href");if(f===null){const T=this.selectWord(this.selection),u=T?T.toString():"";if(!u.length&&(!this.range||!this.range.cloneContents().querySelector("img")))return;this.eVm.editLinkUrl.value=Ot.test(u)?u:"https://",document.execCommand("createLink",!1,this.eVm.editLinkUrl.value),this.save(T.getRangeAt(0))}else this.eVm.editLinkUrl.value=f,this.range.selectNodeContents(this.parent),this.save();return}else if(e==="fullscreen"){this.eVm.toggleFullscreen(),d();return}else if(e==="viewsource"){this.eVm.isViewingSource.value=this.eVm.isViewingSource.value===!1,this.eVm.setContent(this.eVm.props.modelValue),d();return}document.execCommand(e,!1,n),d()}selectWord(e){if(e===null||e.isCollapsed!==!0||e.modify===void 0)return e;const n=document.createRange();n.setStart(e.anchorNode,e.anchorOffset),n.setEnd(e.focusNode,e.focusOffset);const d=n.collapsed?["backward","forward"]:["forward","backward"];n.detach();const f=e.focusNode,T=e.focusOffset;return e.collapse(e.anchorNode,e.anchorOffset),e.modify("move",d[0],"character"),e.modify("move",d[1],"word"),e.extend(f,T),e.modify("extend",d[1],"character"),e.modify("extend",d[0],"word"),e}}function st(l,e,n){e.handler?e.handler(l,n,n.caret):n.runCmd(e.cmd,e.param)}function We(l){return B("div",{class:"q-editor__toolbar-group"},l)}function it(l,e,n,d=!1){const f=d||(e.type==="toggle"?e.toggled?e.toggled(l):e.cmd&&l.caret.is(e.cmd,e.param):!1),T=[];if(e.tip&&l.$q.platform.is.desktop){const u=e.key?B("div",[B("small",`(CTRL + ${String.fromCharCode(e.key)})`)]):null;T.push(B(Ee,{delay:1e3},()=>[B("div",{innerHTML:e.tip}),u]))}return B(A,{...l.buttonProps.value,icon:e.icon!==null?e.icon:void 0,color:f?e.toggleColor||l.props.toolbarToggleColor:e.color||l.props.toolbarColor,textColor:f&&!l.props.toolbarPush?null:e.textColor||l.props.toolbarTextColor,label:e.label,disable:e.disable?typeof e.disable=="function"?e.disable(l):!0:!1,size:"sm",onClick(u){n==null||n(),st(u,e,l)}},()=>T)}function Lt(l,e){const n=e.list==="only-icons";let d=e.label,f=e.icon!==null?e.icon:void 0,T,u;function v(){L.component.proxy.hide()}if(n)u=e.options.map(k=>{const V=k.type===void 0?l.caret.is(k.cmd,k.param):!1;return V&&(d=k.tip,f=k.icon!==null?k.icon:void 0),it(l,k,v,V)}),T=l.toolbarBackgroundClass.value,u=[We(u)];else{const k=l.props.toolbarToggleColor!==void 0?`text-${l.props.toolbarToggleColor}`:null,V=l.props.toolbarTextColor!==void 0?`text-${l.props.toolbarTextColor}`:null,O=e.list==="no-icons";u=e.options.map(P=>{const Q=P.disable?P.disable(l):!1,K=P.type===void 0?l.caret.is(P.cmd,P.param):!1;K&&(d=P.tip,f=P.icon!==null?P.icon:void 0);const Y=P.htmlTip;return B(ne,{active:K,activeClass:k,clickable:!0,disable:Q,dense:!0,onClick(Z){var oe;v(),(Z==null?void 0:Z.qAvoidFocus)!==!0&&((oe=l.contentRef.value)==null||oe.focus()),l.caret.restore(),st(Z,P,l)}},()=>[O===!0?null:B(U,{class:K?k:V,side:!0},()=>B(R,{name:P.icon!==null?P.icon:void 0})),B(U,Y?()=>B("div",{class:"text-no-wrap",innerHTML:P.htmlTip}):P.tip?()=>B("div",{class:"text-no-wrap"},P.tip):void 0)])}),T=[l.toolbarBackgroundClass.value,V]}const C=e.highlight&&d!==e.label,L=B(Ne,{...l.buttonProps.value,noCaps:!0,noWrap:!0,color:C?l.props.toolbarToggleColor:l.props.toolbarColor,textColor:C&&!l.props.toolbarPush?null:l.props.toolbarTextColor,label:e.fixedLabel?e.label:d,icon:e.fixedIcon?e.icon!==null?e.icon:void 0:f,contentClass:T,onShow:k=>l.emit("dropdownShow",k),onHide:k=>l.emit("dropdownHide",k),onBeforeShow:k=>l.emit("dropdownBeforeShow",k),onBeforeHide:k=>l.emit("dropdownBeforeHide",k)},()=>u);return L}function Bt(l){if(l.caret)return l.buttons.value.filter(e=>!l.isViewingSource.value||e.find(n=>n.cmd==="viewsource")).map(e=>We(e.map(n=>l.isViewingSource.value&&n.cmd!=="viewsource"?!1:n.type==="slot"?Se(l.slots[n.slot]):n.type==="dropdown"?Lt(l,n):it(l,n))))}function Vt(l,e,n,d={}){const f=Object.keys(d);if(f.length===0)return{};const T={default_font:{cmd:"fontName",param:l,icon:n,tip:e}};return f.forEach(u=>{const v=d[u];T[u]={cmd:"fontName",param:v,icon:n,tip:v,htmlTip:`<font face="${v}">${v}</font>`}}),T}function Nt(l){if(l.caret){const e=l.props.toolbarColor||l.props.toolbarTextColor;let n=l.editLinkUrl.value;const d=()=>{l.caret.restore(),n!==l.editLinkUrl.value&&document.execCommand("createLink",!1,n===""?" ":n),l.editLinkUrl.value=null};return[B("div",{class:`q-mx-xs text-${e}`},`${l.$q.lang.editor.url}: `),B("input",{key:"qedt_btm_input",class:"col q-editor__link-input",value:n,onInput:f=>{mt(f),n=f.target.value},onKeydown:f=>{if(tt(f)!==!0)switch(f.keyCode){case 13:return Ye(f),d();case 27:Ye(f),l.caret.restore(),(!l.editLinkUrl.value||l.editLinkUrl.value==="https://")&&document.execCommand("unlink"),l.editLinkUrl.value=null;break}}}),We([B(A,{key:"qedt_btm_rem",tabindex:-1,...l.buttonProps.value,label:l.$q.lang.label.remove,noCaps:!0,onClick:()=>{l.caret.restore(),document.execCommand("unlink"),l.editLinkUrl.value=null}}),B(A,{key:"qedt_btm_upd",...l.buttonProps.value,label:l.$q.lang.label.update,noCaps:!0,onClick:d})])]}}const Ut=Object.prototype.toString,Ve=Object.prototype.hasOwnProperty,Ht=new Set(["Boolean","Number","String","Function","Array","Date","RegExp"].map(l=>"[object "+l+"]"));function et(l){if(l!==Object(l)||Ht.has(Ut.call(l))===!0||l.constructor&&Ve.call(l,"constructor")===!1&&Ve.call(l.constructor.prototype,"isPrototypeOf")===!1)return!1;let e;for(e in l);return e===void 0||Ve.call(l,e)}function rt(){let l,e,n,d,f,T,u=arguments[0]||{},v=1,C=!1;const L=arguments.length;for(typeof u=="boolean"&&(C=u,u=arguments[1]||{},v=2),Object(u)!==u&&typeof u!="function"&&(u={}),L===v&&(u=this,v--);v<L;v++)if((l=arguments[v])!==null)for(e in l)n=u[e],d=l[e],u!==d&&(C===!0&&d&&((f=Array.isArray(d))||et(d)===!0)?(f===!0?T=Array.isArray(n)===!0?n:[]:T=et(n)===!0?n:{},u[e]=rt(C,T,d)):d!==void 0&&(u[e]=d));return u}var It=Ue({name:"QEditor",props:{...He,...pt,modelValue:{type:String,required:!0},readonly:Boolean,disable:Boolean,minHeight:{type:String,default:"10rem"},maxHeight:String,height:String,definitions:Object,fonts:Object,placeholder:String,toolbar:{type:Array,validator:l=>l.length===0||l.every(e=>e.length),default:()=>[["left","center","right","justify"],["bold","italic","underline","strike"],["undo","redo"]]},toolbarColor:String,toolbarBg:String,toolbarTextColor:String,toolbarToggleColor:{type:String,default:"primary"},toolbarOutline:Boolean,toolbarPush:Boolean,toolbarRounded:Boolean,paragraphTag:{type:String,validator:l=>["div","p"].includes(l),default:"div"},contentStyle:Object,contentClass:[Object,Array,String],square:Boolean,flat:Boolean,dense:Boolean},emits:[...ft,"update:modelValue","keydown","click","focus","blur","dropdownShow","dropdownHide","dropdownBeforeShow","dropdownBeforeHide","linkShow","linkHide"],setup(l,{slots:e,emit:n}){const{proxy:d}=Qe(),{$q:f}=d,T=Ie(l,f),{inFullscreen:u,toggleFullscreen:v}=vt(),C=ht(),L=S(null),k=S(null),V=S(null),O=S(!1),P=I(()=>!l.readonly&&!l.disable);let Q,K,Y=l.modelValue;document.execCommand("defaultParagraphSeparator",!1,l.paragraphTag),Q=window.getComputedStyle(document.body).fontFamily;const Z=I(()=>l.toolbarBg?` bg-${l.toolbarBg}`:""),oe=I(()=>{const i=l.toolbarOutline!==!0&&l.toolbarPush!==!0;return{type:"a",flat:i,noWrap:!0,outline:l.toolbarOutline,push:l.toolbarPush,rounded:l.toolbarRounded,dense:!0,color:l.toolbarColor,disable:!P.value,size:"sm"}}),se=I(()=>{const i=f.lang.editor,c=f.iconSet.editor;return{bold:{cmd:"bold",icon:c.bold,tip:i.bold,key:66},italic:{cmd:"italic",icon:c.italic,tip:i.italic,key:73},strike:{cmd:"strikeThrough",icon:c.strikethrough,tip:i.strikethrough,key:83},underline:{cmd:"underline",icon:c.underline,tip:i.underline,key:85},unordered:{cmd:"insertUnorderedList",icon:c.unorderedList,tip:i.unorderedList},ordered:{cmd:"insertOrderedList",icon:c.orderedList,tip:i.orderedList},subscript:{cmd:"subscript",icon:c.subscript,tip:i.subscript,htmlTip:"x<subscript>2</subscript>"},superscript:{cmd:"superscript",icon:c.superscript,tip:i.superscript,htmlTip:"x<superscript>2</superscript>"},link:{cmd:"link",disable:$=>$.caret&&!$.caret.can("link"),icon:c.hyperlink,tip:i.hyperlink,key:76},fullscreen:{cmd:"fullscreen",icon:c.toggleFullscreen,tip:i.toggleFullscreen,key:70},viewsource:{cmd:"viewsource",icon:c.viewSource,tip:i.viewSource},quote:{cmd:"formatBlock",param:"BLOCKQUOTE",icon:c.quote,tip:i.quote,key:81},left:{cmd:"justifyLeft",icon:c.left,tip:i.left},center:{cmd:"justifyCenter",icon:c.center,tip:i.center},right:{cmd:"justifyRight",icon:c.right,tip:i.right},justify:{cmd:"justifyFull",icon:c.justify,tip:i.justify},print:{type:"no-state",cmd:"print",icon:c.print,tip:i.print,key:80},outdent:{type:"no-state",disable:$=>$.caret&&!$.caret.can("outdent"),cmd:"outdent",icon:c.outdent,tip:i.outdent},indent:{type:"no-state",disable:$=>$.caret&&!$.caret.can("indent"),cmd:"indent",icon:c.indent,tip:i.indent},removeFormat:{type:"no-state",cmd:"removeFormat",icon:c.removeFormat,tip:i.removeFormat},hr:{type:"no-state",cmd:"insertHorizontalRule",icon:c.hr,tip:i.hr},undo:{type:"no-state",cmd:"undo",icon:c.undo,tip:i.undo,key:90},redo:{type:"no-state",cmd:"redo",icon:c.redo,tip:i.redo,key:89},h1:{cmd:"formatBlock",param:"H1",icon:c.heading1||c.heading,tip:i.heading1,htmlTip:`<h1 class="q-ma-none">${i.heading1}</h1>`},h2:{cmd:"formatBlock",param:"H2",icon:c.heading2||c.heading,tip:i.heading2,htmlTip:`<h2 class="q-ma-none">${i.heading2}</h2>`},h3:{cmd:"formatBlock",param:"H3",icon:c.heading3||c.heading,tip:i.heading3,htmlTip:`<h3 class="q-ma-none">${i.heading3}</h3>`},h4:{cmd:"formatBlock",param:"H4",icon:c.heading4||c.heading,tip:i.heading4,htmlTip:`<h4 class="q-ma-none">${i.heading4}</h4>`},h5:{cmd:"formatBlock",param:"H5",icon:c.heading5||c.heading,tip:i.heading5,htmlTip:`<h5 class="q-ma-none">${i.heading5}</h5>`},h6:{cmd:"formatBlock",param:"H6",icon:c.heading6||c.heading,tip:i.heading6,htmlTip:`<h6 class="q-ma-none">${i.heading6}</h6>`},p:{cmd:"formatBlock",param:l.paragraphTag,icon:c.heading,tip:i.paragraph},code:{cmd:"formatBlock",param:"PRE",icon:c.code,htmlTip:`<code>${i.code}</code>`},"size-1":{cmd:"fontSize",param:"1",icon:c.size1||c.size,tip:i.size1,htmlTip:`<font size="1">${i.size1}</font>`},"size-2":{cmd:"fontSize",param:"2",icon:c.size2||c.size,tip:i.size2,htmlTip:`<font size="2">${i.size2}</font>`},"size-3":{cmd:"fontSize",param:"3",icon:c.size3||c.size,tip:i.size3,htmlTip:`<font size="3">${i.size3}</font>`},"size-4":{cmd:"fontSize",param:"4",icon:c.size4||c.size,tip:i.size4,htmlTip:`<font size="4">${i.size4}</font>`},"size-5":{cmd:"fontSize",param:"5",icon:c.size5||c.size,tip:i.size5,htmlTip:`<font size="5">${i.size5}</font>`},"size-6":{cmd:"fontSize",param:"6",icon:c.size6||c.size,tip:i.size6,htmlTip:`<font size="6">${i.size6}</font>`},"size-7":{cmd:"fontSize",param:"7",icon:c.size7||c.size,tip:i.size7,htmlTip:`<font size="7">${i.size7}</font>`}}}),p=I(()=>{const i=l.definitions||{},c=l.definitions||l.fonts?rt(!0,{},se.value,i,Vt(Q,f.lang.editor.defaultFont,f.iconSet.editor.font,l.fonts)):se.value;return l.toolbar.map($=>$.map(M=>{if(M.options)return{type:"dropdown",icon:M.icon,label:M.label,size:"sm",dense:!0,fixedLabel:M.fixedLabel,fixedIcon:M.fixedIcon,highlight:M.highlight,list:M.list,options:M.options.map(Ce=>c[Ce])};const ue=c[M];return ue?ue.type==="no-state"||i[M]&&(ue.cmd===void 0||se.value[ue.cmd]&&se.value[ue.cmd].type==="no-state")?ue:Object.assign({type:"toggle"},ue):{type:"slot",slot:M}}))}),w={$q:f,props:l,slots:e,emit:n,inFullscreen:u,toggleFullscreen:v,runCmd:we,isViewingSource:O,editLinkUrl:V,toolbarBackgroundClass:Z,buttonProps:oe,contentRef:k,buttons:p,setContent:ke};de(()=>l.modelValue,i=>{Y!==i&&(Y=i,ke(i,!0))}),de(V,i=>{n(`link${i?"Show":"Hide"}`)});const h=I(()=>l.toolbar&&l.toolbar.length!==0),ee=I(()=>{const i={},c=$=>{$.key&&(i[$.key]={cmd:$.cmd,param:$.param})};return p.value.forEach($=>{$.forEach(M=>{M.options?M.options.forEach(c):c(M)})}),i}),ie=I(()=>u.value?l.contentStyle:[{minHeight:l.minHeight,height:l.height,maxHeight:l.maxHeight},l.contentStyle]),ve=I(()=>`q-editor q-editor--${O.value===!0?"source":"default"}`+(l.disable===!0?" disabled":"")+(u.value===!0?" fullscreen column":"")+(l.square===!0?" q-editor--square no-border-radius":"")+(l.flat===!0?" q-editor--flat":"")+(l.dense===!0?" q-editor--dense":"")+(T.value===!0?" q-editor--dark q-dark":"")),pe=I(()=>[l.contentClass,"q-editor__content",{col:u.value,"overflow-auto":u.value||l.maxHeight}]),he=I(()=>l.disable===!0?{"aria-disabled":"true"}:{});function F(){if(k.value!==null){const i=`inner${O.value===!0?"Text":"HTML"}`,c=k.value[i];c!==l.modelValue&&(Y=c,n("update:modelValue",c))}}function b(i){if(n("keydown",i),i.ctrlKey!==!0||tt(i)===!0){re();return}const c=i.keyCode,$=ee.value[c];if($!==void 0){const{cmd:M,param:ue}=$;yt(i),we(M,ue,!1)}}function g(i){re(),n("click",i)}function x(i){if(k.value!==null){const{scrollTop:c,scrollHeight:$}=k.value;K=$-c}w.caret.save(),n("blur",i)}function fe(i){lt(()=>{k.value!==null&&K!==void 0&&(k.value.scrollTop=k.value.scrollHeight-K)}),n("focus",i)}function N(i){const c=L.value;if(c!==null&&c.contains(i.target)===!0&&(i.relatedTarget===null||c.contains(i.relatedTarget)!==!0)){const $=`inner${O.value===!0?"Text":"HTML"}`;w.caret.restorePosition(k.value[$].length),re()}}function be(i){const c=L.value;c!==null&&c.contains(i.target)===!0&&(i.relatedTarget===null||c.contains(i.relatedTarget)!==!0)&&(w.caret.savePosition(),re())}function $e(){K=void 0}function ge(i){w.caret.save()}function ke(i,c){if(k.value!==null){c===!0&&w.caret.savePosition();const $=`inner${O.value===!0?"Text":"HTML"}`;k.value[$]=i,c===!0&&(w.caret.restorePosition(k.value[$].length),re())}}function we(i,c,$=!0){xe(),w.caret.restore(),w.caret.apply(i,c,()=>{xe(),w.caret.save(),$&&re()})}function re(){setTimeout(()=>{V.value=null,d.$forceUpdate()},1)}function xe(){_t(()=>{var i;(i=k.value)==null||i.focus({preventScroll:!0})})}function ye(){return k.value}return ze(()=>{w.caret=d.caret=new At(k.value,w),ke(l.modelValue),re(),document.addEventListener("selectionchange",ge)}),gt(()=>{document.removeEventListener("selectionchange",ge)}),Object.assign(d,{runCmd:we,refreshToolbar:re,focus:xe,getContentEl:ye}),()=>{let i;if(h.value){const c=[B("div",{key:"qedt_top",class:"q-editor__toolbar row no-wrap scroll-x"+Z.value},Bt(w))];V.value!==null&&c.push(B("div",{key:"qedt_btm",class:"q-editor__toolbar row no-wrap items-center scroll-x"+Z.value},Nt(w))),i=B("div",{key:"toolbar_ctainer",class:"q-editor__toolbars-container"},c)}return B("div",{ref:L,class:ve.value,style:{height:u.value===!0?"100%":null},...he.value,onFocusin:N,onFocusout:be},[i,B("div",{ref:k,style:ie.value,class:pe.value,contenteditable:P.value,placeholder:l.placeholder,...C.listeners.value,onInput:F,onKeydown:b,onClick:g,onBlur:x,onFocus:fe,onMousedown:$e,onTouchstartPassive:$e})])}}});const Qt={class:"template-field-editor q-pa-md"},Mt={class:"row q-col-gutter-md q-mb-md"},Rt={class:"col-12"},jt={class:"row q-col-gutter-md"},Wt={class:"col-12 col-md-4"},Kt={class:"fields-list q-mb-md"},Yt={class:"row items-center no-wrap"},Jt={class:"text-weight-medium ellipsis"},Gt={class:"text-caption"},Xt={class:"col-12 col-md-8"},Zt={class:"row q-col-gutter-sm q-mb-md"},el={class:"col-12"},tl={class:"row items-center q-mb-sm"},ll={class:"row q-gutter-sm"},al={class:"form-layout bg-grey-1 rounded-borders q-pa-md"},ol={key:0,class:"text-center q-py-xl"},nl={key:1},sl={class:"section-header bg-primary text-white q-pa-sm q-mb-md rounded-borders"},il={class:"text-subtitle1"},rl={class:"row q-col-gutter-md"},ul={class:"row items-center no-wrap"},dl={class:"row items-center"},cl={class:"text-subtitle2"},ml={class:"q-mt-sm"},pl={key:6,class:"q-pa-sm bg-grey-2 rounded-borders"},fl={key:0,class:"text-caption q-mt-xs text-grey-8"},vl={class:"row q-col-gutter-md"},hl={class:"col-12 col-md-3"},gl={class:"row items-center"},yl={class:"col-12 col-md-9"},_l={class:"section-header bg-primary text-white q-pa-sm q-mb-md rounded-borders"},bl={class:"text-subtitle1"},kl={class:"row q-col-gutter-md"},wl={key:6,class:"q-pa-sm bg-grey-2 rounded-borders"},xl={class:"text-h6"},Cl={class:"row q-col-gutter-md"},ql={class:"col-12"},Sl={class:"col-12"},Tl={class:"col-12 col-md-6"},Fl={class:"col-12 col-md-6"},$l={class:"col-12"},Dl={class:"col-12"},Pl={class:"col-12"},El={key:0,class:"col-12"},zl={class:"col"},Ol={class:"col-auto"},Al={class:"col-12"},Ll={class:"text-h6"},Bl=Me({__name:"TemplateFieldEditor",props:{fields:{type:Array,default:()=>[]},sections:{type:Array,default:()=>[{id:"section_default",name:"Default",order:0}]},htmlContent:{type:String,default:""}},emits:["update:fields","update:sections","update:htmlContent"],setup(l,{emit:e}){const n=Re(),d=l,f=e,T=S("form"),u=S([]),v=S([]),C=S(!1),L=S(!1),k=S(null),V=S(-1),O=S("Default"),P=S(d.htmlContent||""),Q=[{label:"Text Field",value:"text"},{label:"Email Field",value:"email"},{label:"Number Field",value:"number"},{label:"Password Field",value:"password"},{label:"Telephone Field",value:"tel"},{label:"Text Area",value:"textarea"},{label:"Select Dropdown",value:"select"},{label:"Radio Buttons",value:"radio"},{label:"Checkbox",value:"checkbox"},{label:"Date Picker",value:"date"}],K=[{label:"Full Width",value:"full"},{label:"Half Width",value:"half"},{label:"One Third",value:"third"}],Y=I(()=>(console.log("Computing section options from:",v.value),v.value.map(r=>({label:r.name,value:r.name})))),Z=I(()=>u.value.filter(r=>r.section_name===O.value));de(()=>d.htmlContent,r=>{P.value=r||""},{immediate:!0}),de(()=>d.sections,r=>{console.log("New sections from props:",r),!r||!Array.isArray(r)||r.length===0?v.value=[{id:"section_default",name:"Default",order:0}]:(v.value=JSON.parse(JSON.stringify(r)),v.value.find(a=>a.name==="Default")||v.value.push({id:"section_default",name:"Default",order:v.value.length})),v.value=v.value.map(a=>a.id?a:{...a,id:"section_"+(a.name?a.name.toLowerCase().replace(/[^a-z0-9]/g,"_"):Date.now())}),v.value.sort((a,o)=>(a.order||0)-(o.order||0)),v.value.find(a=>a.name===O.value)||(O.value="Default"),console.log("Section options after processing:",Y.value)},{immediate:!0,deep:!0}),de(()=>d.fields,r=>{if(console.log("New fields from props:",r),Array.isArray(r)&&(u.value=JSON.parse(JSON.stringify(r)),u.value.forEach(a=>{a.section_name||(a.section_name="Default"),a.id||(a.id="field_"+Date.now()+Math.floor(Math.random()*1e3))}),(!d.sections||d.sections.length===0||d.sections.length===1)&&u.value.length>0)){const a=new Set;a.add("Default"),u.value.forEach(o=>{o.section_name&&o.section_name.trim()&&a.add(o.section_name.trim())}),a.size>1&&(v.value=Array.from(a).map((o,q)=>({id:o==="Default"?"section_default":"section_"+o.toLowerCase().replace(/[^a-z0-9]/g,"_"),name:o,order:q})),f("update:sections",v.value))}console.log("Processed fields:",u.value)},{immediate:!0,deep:!0});const oe=r=>{if(r){let a=r;a=a.replace(/\\n/g,`
`),a=a.replace(/\r\n/g,`
`),a=a.replace(/\r/g,`
`),a=a.trim(),console.log("Processed HTML content in editor:",a),f("update:htmlContent",a)}else f("update:htmlContent","")},se=r=>{const a=`{{${r.name}}}`;navigator.clipboard&&navigator.clipboard.writeText?navigator.clipboard.writeText(a).then(()=>{n.notify({message:`Field placeholder copied to clipboard: ${a}`,color:"positive",icon:"fa-solid fa-copy"})}).catch(q=>{console.error("Failed to copy text: ",q),o()}):o();function o(){const q=document.createElement("textarea");q.value=a,document.body.appendChild(q),q.select(),document.execCommand("copy"),document.body.removeChild(q),n.notify({message:`Field placeholder copied to clipboard: ${a}`,color:"positive",icon:"fa-solid fa-copy"})}},p=()=>{n.dialog({title:"Insert Field Placeholder",message:"Select a field to insert:",options:{type:"radio",model:"",items:u.value.map(r=>({label:r.label||r.name,value:r.name}))},persistent:!0,ok:{label:"Insert",flat:!1,color:"primary"},cancel:{flat:!0}}).onOk(r=>{r&&document.execCommand("insertHTML",!1,`{{${r}}}`)})},w=()=>{n.dialog({title:"Insert Common Element",options:{type:"radio",model:"",items:[{label:"Header",value:"header"},{label:"Paragraph",value:"paragraph"},{label:"Signature Line",value:"signature"},{label:"Date Line",value:"date"},{label:"Page Break",value:"pagebreak"},{label:"Table",value:"table"}]},persistent:!0,ok:{label:"Insert",flat:!1,color:"primary"},cancel:{flat:!0}}).onOk(r=>{let a="";switch(r){case"header":a='<h2 style="margin-bottom: 20px;">Document Title</h2>';break;case"paragraph":a='<p style="margin-bottom: 15px;">Enter your paragraph text here.</p>';break;case"signature":a='<div style="margin-top: 40px; border-top: 1px solid #000; padding-top: 5px; width: 250px;">Signature</div>';break;case"date":a='<div style="margin-top: 20px;">Date: <span style="text-decoration: underline; padding: 0 50px;">{{date}}</span></div>';break;case"pagebreak":a='<div style="page-break-after: always;"></div>';break;case"table":a='<table border="1" style="width: 100%; border-collapse: collapse;"><thead><tr><th>Header 1</th><th>Header 2</th><th>Header 3</th></tr></thead><tbody><tr><td>Value 1</td><td>Value 2</td><td>Value 3</td></tr><tr><td>Value 4</td><td>Value 5</td><td>Value 6</td></tr></tbody></table>';break}a&&document.execCommand("insertHTML",!1,a)})},h=S({id:"",name:"",label:"",type:"text",placeholder:"",help_text:"",required:!1,section_name:O.value,width:"full",options:[]}),ee=S([""]),ie=S({name:""}),ve=r=>{const a=Q.find(o=>o.value===r);return a?a.label:r},pe=r=>{switch(r){case"text":return"fa-solid fa-font";case"email":return"fa-solid fa-envelope";case"number":return"fa-solid fa-hashtag";case"password":return"fa-solid fa-lock";case"tel":return"fa-solid fa-phone";case"textarea":return"fa-solid fa-align-left";case"select":return"fa-solid fa-list";case"radio":return"fa-solid fa-circle-dot";case"checkbox":return"fa-solid fa-check-square";case"date":return"fa-solid fa-calendar";case"signature":return"fa-solid fa-signature";default:return"fa-solid fa-keyboard"}},he=r=>{if(r<0||r>=u.value.length)return;const a=u.value[r];V.value=r,h.value={...a},["select","radio","checkbox"].includes(a.type)&&a.options&&a.options.length>0?ee.value=[...a.options]:ee.value=[""],C.value=!0},F=()=>{h.value.id||(h.value.id="field_"+Date.now()),["select","radio","checkbox"].includes(h.value.type)&&(h.value.options=ee.value.filter(r=>!!r)),V.value>=0?u.value[V.value]={...h.value}:u.value.push({...h.value}),f("update:fields",u.value),g(),C.value=!1},b=r=>{n.dialog({title:"Confirm Deletion",message:"Are you sure you want to remove this field?",cancel:!0,persistent:!0}).onOk(()=>{u.value.splice(r,1),f("update:fields",u.value)})},g=()=>{h.value={id:"",name:"",label:"",type:"text",placeholder:"",help_text:"",required:!1,section_name:O.value,width:"full",options:[]},ee.value=[""],V.value=-1};ze(()=>{v.value.some(r=>r.name==="Default")||v.value.push({id:"section_default",name:"Default",order:0})});const x=()=>{ee.value.push("")},fe=r=>{ee.value.splice(r,1),ee.value.length===0&&ee.value.push("")},N=()=>{ie.value={name:""},L.value=!0},be=r=>{const a=(r||"").trim();return a||"Default"},$e=()=>{const r=be(ie.value.name);if(v.value.some(o=>o.name.toLowerCase()===r.toLowerCase()&&o.id!==k.value)){n.notify({type:"negative",message:"A section with this name already exists"});return}if(k.value){const o=v.value.findIndex(q=>q.id===k.value);if(o!==-1){const q=v.value[o].name,y=r;v.value[o].name=y,u.value.forEach(te=>{te.section_name===q&&(te.section_name=y)}),O.value===q&&(O.value=y),f("update:fields",u.value),f("update:sections",v.value)}}else{const o={id:"section_"+r.toLowerCase().replace(/[^a-z0-9]/g,"_"),name:r,order:v.value.length};v.value.push(o),f("update:sections",v.value),O.value=o.name}L.value=!1,Ce()},ge=(r,a)=>{const o=u.value.findIndex(q=>q.id===r.id);o>=0&&(u.value[o].width=a,f("update:fields",u.value))},ke=r=>u.value.filter(o=>o.section_name===r.section_name).indexOf(r)===0,we=r=>{const a=u.value.filter(o=>o.section_name===r.section_name);return a.indexOf(r)===a.length-1},re=(r,a)=>{if(r<0||r>=u.value.length)return;const o=u.value[r],q=u.value.filter(dt=>dt.section_name===o.section_name),y=q.indexOf(o);let te;if(a==="up"&&y>0)te=y-1;else if(a==="down"&&y<q.length-1)te=y+1;else return;const ut=q[te],Ke=u.value.indexOf(ut);[u.value[r],u.value[Ke]]=[u.value[Ke],u.value[r]],f("update:fields",u.value)},xe=(r,a)=>{if(r.section_name===a)return;const o=u.value.findIndex(q=>q.id===r.id);o>=0&&(u.value[o].section_name=a,f("update:fields",u.value))},ye=r=>u.value.findIndex(a=>a.id===r.id),i=r=>u.value.filter(a=>a.section_name===r),c=r=>!r||!Array.isArray(r)?[]:r.map(a=>({label:a,value:a})),$=r=>{r&&(k.value=r.id,ie.value={name:r.name},L.value=!0)},M=r=>{r.name==="Default"||v.value.length<=1||n.dialog({title:"Confirm Section Deletion",message:`Are you sure you want to delete the section "${r.name}"? Fields in this section will be moved to Default section.`,cancel:!0,persistent:!0}).onOk(()=>{ue(r)})},ue=r=>{const a=v.value.find(o=>o.name==="Default")||v.value.find(o=>o.id!==r.id);if(!a){n.notify({type:"negative",message:"Cannot delete the only section"});return}u.value.forEach(o=>{o.section_name===r.name&&(o.section_name=a.name)}),v.value=v.value.filter(o=>o.id!==r.id),f("update:fields",u.value),f("update:sections",v.value),O.value===r.name&&(O.value=a.name)},Ce=()=>{ie.value={name:""},k.value=null};return(r,a)=>(_(),E("div",Qt,[a[39]||(a[39]=m("div",{class:"text-h6 q-mb-md"},"Template Field Editor",-1)),m("div",Mt,[m("div",Rt,[t(bt,{modelValue:T.value,"onUpdate:modelValue":a[0]||(a[0]=o=>T.value=o),dense:"",class:"text-grey","active-color":"primary","indicator-color":"primary",align:"left","narrow-indicator":""},{default:s(()=>[t(Oe,{name:"form",label:"Form Layout"}),t(Oe,{name:"html",label:"HTML Editor"}),t(Oe,{name:"preview",label:"Preview"})]),_:1},8,["modelValue"]),t(De),t(kt,{modelValue:T.value,"onUpdate:modelValue":a[3]||(a[3]=o=>T.value=o),animated:""},{default:s(()=>[t(Ae,{name:"form"},{default:s(()=>[m("div",jt,[m("div",Wt,[t(le,{flat:"",bordered:""},{default:s(()=>[t(W,null,{default:s(()=>[a[15]||(a[15]=m("div",{class:"text-subtitle1 q-mb-sm"},"Form Fields",-1)),m("div",Kt,[(_(!0),E(ce,null,me(u.value,(o,q)=>(_(),E("div",{key:o.id||q,class:"field-item q-pa-sm q-mb-sm bg-grey-2 rounded-borders"},[m("div",Yt,[t(R,{name:"fa-solid fa-grip-vertical",size:"xs",class:"q-mr-sm cursor-move drag-handle"}),t(R,{name:pe(o.type),size:"xs",class:"q-mr-sm text-primary"},null,8,["name"]),m("div",Jt,z(o.label||o.name),1),t(_e),t(A,{flat:"",round:"",dense:"",size:"sm",color:"primary",icon:"fa-solid fa-pen",onClick:y=>he(q)},null,8,["onClick"]),t(A,{flat:"",round:"",dense:"",size:"sm",color:"negative",icon:"fa-solid fa-trash",onClick:y=>b(q)},null,8,["onClick"])]),m("div",Gt,z(ve(o.type)),1)]))),128))]),t(A,{outline:"",color:"primary",label:"Add Field",class:"full-width",icon:"fa-solid fa-plus",onClick:a[1]||(a[1]=o=>C.value=!0)})]),_:1})]),_:1})]),m("div",Xt,[t(le,{flat:"",bordered:""},{default:s(()=>[t(W,null,{default:s(()=>[a[32]||(a[32]=m("div",{class:"text-subtitle1 q-mb-sm"},"Form Layout",-1)),m("div",Zt,[m("div",el,[m("div",tl,[a[17]||(a[17]=m("div",{class:"text-subtitle1"},"Sections",-1)),t(_e),t(A,{flat:"",dense:"",icon:"fa-solid fa-plus",color:"primary",onClick:N},{default:s(()=>[t(Ee,null,{default:s(()=>a[16]||(a[16]=[H("Add New Section")])),_:1})]),_:1})]),m("div",ll,[(_(!0),E(ce,null,me(v.value,o=>(_(),D(wt,{key:o.id,color:O.value===o.name?"primary":"grey-3","text-color":O.value===o.name?"white":"black",clickable:"",onClick:q=>O.value=o.name,class:"section-chip"},{default:s(()=>[H(z(o.name)+" ",1),t(A,{round:"",flat:"",dense:"",size:"xs",icon:"fa-solid fa-pencil",class:"q-ml-xs",onClick:Je(q=>$(o),["stop"])},{default:s(()=>[t(Ee,null,{default:s(()=>a[18]||(a[18]=[H("Edit Section")])),_:1})]),_:2},1032,["onClick"]),t(A,{round:"",flat:"",dense:"",size:"xs",icon:"fa-solid fa-trash",class:"q-ml-xs",onClick:Je(q=>M(o),["stop"]),disable:o.name==="Default"||v.value.length===1},{default:s(()=>[t(Ee,null,{default:s(()=>a[19]||(a[19]=[H("Delete Section")])),_:1})]),_:2},1032,["onClick","disable"])]),_:2},1032,["color","text-color","onClick"]))),128))])])]),m("div",al,[Z.value.length===0?(_(),E("div",ol,[t(R,{name:"fa-solid fa-arrow-left",size:"sm",class:"q-mr-xs"}),a[20]||(a[20]=H(" Add fields from the sidebar "))])):(_(),E("div",nl,[m("div",sl,[m("div",il,z(O.value),1)]),m("div",rl,[(_(!0),E(ce,null,me(Z.value,(o,q)=>(_(),E("div",{key:o.id||q,class:Ge([o.width==="full"?"col-12":o.width==="half"?"col-12 col-md-6":o.width==="third"?"col-12 col-md-4":"col-12 col-md-6"])},[t(le,{flat:"",bordered:"",class:"field-preview"},{default:s(()=>[t(W,{class:"q-py-sm"},{default:s(()=>[m("div",ul,[m("div",dl,[t(R,{name:pe(o.type),size:"sm",class:"q-mr-xs text-primary"},null,8,["name"]),m("div",cl,z(o.label||o.name),1),o.required?(_(),D(at,{key:0,color:"negative",class:"q-ml-sm"},{default:s(()=>a[21]||(a[21]=[H("Required")])),_:1})):X("",!0)]),t(_e),t(Ne,{flat:"",dense:"",round:"",icon:"fa-solid fa-ellipsis-v","dropdown-icon":"none"},{default:s(()=>[t(Pe,null,{default:s(()=>[J((_(),D(ne,{clickable:"",onClick:y=>he(ye(o))},{default:s(()=>[t(U,{avatar:""},{default:s(()=>[t(R,{name:"fa-solid fa-pen"})]),_:1}),t(U,null,{default:s(()=>a[22]||(a[22]=[H("Edit Field")])),_:1})]),_:2},1032,["onClick"])),[[G]]),J((_(),D(ne,{clickable:"",onClick:y=>b(ye(o))},{default:s(()=>[t(U,{avatar:""},{default:s(()=>[t(R,{name:"fa-solid fa-trash"})]),_:1}),t(U,null,{default:s(()=>a[23]||(a[23]=[H("Remove Field")])),_:1})]),_:2},1032,["onClick"])),[[G]]),t(De),t(ae,{header:""},{default:s(()=>a[24]||(a[24]=[H("Move Field")])),_:1}),J((_(),D(ne,{clickable:"",onClick:y=>re(ye(o),"up"),disable:ke(o)},{default:s(()=>[t(U,null,{default:s(()=>[t(ae,null,{default:s(()=>a[25]||(a[25]=[H("Move Up")])),_:1})]),_:1}),t(U,{avatar:""},{default:s(()=>[t(R,{name:"fa-solid fa-arrow-up",color:"primary"})]),_:1})]),_:2},1032,["onClick","disable"])),[[G]]),J((_(),D(ne,{clickable:"",onClick:y=>re(ye(o),"down"),disable:we(o)},{default:s(()=>[t(U,null,{default:s(()=>[t(ae,null,{default:s(()=>a[26]||(a[26]=[H("Move Down")])),_:1})]),_:1}),t(U,{avatar:""},{default:s(()=>[t(R,{name:"fa-solid fa-arrow-down",color:"primary"})]),_:1})]),_:2},1032,["onClick","disable"])),[[G]]),t(De),t(ae,{header:""},{default:s(()=>a[27]||(a[27]=[H("Field Width")])),_:1}),J((_(),D(ne,{clickable:"",onClick:y=>ge(o,"full")},{default:s(()=>[t(U,null,{default:s(()=>[t(ae,null,{default:s(()=>a[28]||(a[28]=[H("Full Width")])),_:1})]),_:1}),o.width==="full"?(_(),D(U,{key:0,avatar:""},{default:s(()=>[t(R,{name:"fa-solid fa-check",color:"primary"})]),_:1})):X("",!0)]),_:2},1032,["onClick"])),[[G]]),J((_(),D(ne,{clickable:"",onClick:y=>ge(o,"half")},{default:s(()=>[t(U,null,{default:s(()=>[t(ae,null,{default:s(()=>a[29]||(a[29]=[H("Half Width")])),_:1})]),_:1}),o.width==="half"?(_(),D(U,{key:0,avatar:""},{default:s(()=>[t(R,{name:"fa-solid fa-check",color:"primary"})]),_:1})):X("",!0)]),_:2},1032,["onClick"])),[[G]]),J((_(),D(ne,{clickable:"",onClick:y=>ge(o,"third")},{default:s(()=>[t(U,null,{default:s(()=>[t(ae,null,{default:s(()=>a[30]||(a[30]=[H("One Third")])),_:1})]),_:1}),o.width==="third"?(_(),D(U,{key:0,avatar:""},{default:s(()=>[t(R,{name:"fa-solid fa-check",color:"primary"})]),_:1})):X("",!0)]),_:2},1032,["onClick"])),[[G]]),t(De),t(ne,null,{default:s(()=>[t(U,null,{default:s(()=>[t(ae,{header:""},{default:s(()=>a[31]||(a[31]=[H("Move to Section")])),_:1})]),_:1}),t(U,{side:""},{default:s(()=>[t(Ne,{dense:"",flat:"",size:"sm",icon:"fa-solid fa-angle-right",class:"submenu-dropdown","dropdown-icon":"none"},{default:s(()=>[t(Pe,{dense:""},{default:s(()=>[(_(!0),E(ce,null,me(v.value,y=>J((_(),D(ne,{key:y.id,clickable:"",onClick:te=>xe(o,y.name),disable:o.section_name===y.name},{default:s(()=>[t(U,null,{default:s(()=>[t(ae,null,{default:s(()=>[H(z(y.name),1)]),_:2},1024)]),_:2},1024),o.section_name===y.name?(_(),D(U,{key:0,avatar:""},{default:s(()=>[t(R,{name:"fa-solid fa-check",color:"primary"})]),_:1})):X("",!0)]),_:2},1032,["onClick","disable"])),[[G]])),128))]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1024)]),m("div",ml,[["text","email","password","tel","number"].includes(o.type)?(_(),D(j,{key:0,outlined:"",dense:"",readonly:"",type:o.type,label:o.placeholder||"Enter "+o.label},null,8,["type","label"])):o.type==="select"?(_(),D(qe,{key:1,outlined:"",dense:"",readonly:"",label:o.placeholder||"Select "+o.label,options:o.options||[],modelValue:""},null,8,["label","options"])):o.type==="textarea"?(_(),D(j,{key:2,outlined:"",dense:"",readonly:"",type:"textarea",label:o.placeholder||"Enter "+o.label},null,8,["label"])):o.type==="date"?(_(),D(j,{key:3,outlined:"",dense:"",readonly:"",type:"date",label:o.placeholder||"Select date"},null,8,["label"])):o.type==="radio"?(_(),D(Xe,{key:4,readonly:"",options:c(o.options||[]),type:"radio",modelValue:""},null,8,["options"])):o.type==="checkbox"?(_(),D(Le,{key:5,label:o.label,readonly:""},null,8,["label"])):(_(),E("div",pl,z(o.label)+": ["+z(o.type)+" field] ",1))]),o.help_text?(_(),E("div",fl,z(o.help_text),1)):X("",!0)]),_:2},1024)]),_:2},1024)],2))),128))])]))])]),_:1})]),_:1})])])]),_:1}),t(Ae,{name:"html"},{default:s(()=>[m("div",vl,[m("div",hl,[t(le,{flat:"",bordered:""},{default:s(()=>[t(W,null,{default:s(()=>[a[33]||(a[33]=m("div",{class:"text-subtitle1 q-mb-sm"},"Available Fields",-1)),a[34]||(a[34]=m("p",{class:"text-caption q-mb-sm"},"Click on a field to insert it into the editor",-1)),t(Pe,{dense:"",bordered:"",separator:""},{default:s(()=>[(_(!0),E(ce,null,me(u.value,o=>(_(),D(ne,{key:o.id,clickable:"",onClick:q=>se(o)},{default:s(()=>[t(U,null,{default:s(()=>[m("div",gl,[t(R,{name:pe(o.type),size:"xs",class:"q-mr-sm text-primary"},null,8,["name"]),t(ae,null,{default:s(()=>[H(z(o.label||o.name),1)]),_:2},1024)]),t(ae,{caption:""},{default:s(()=>[H(z(ve(o.type)),1)]),_:2},1024)]),_:2},1024),t(U,{side:""},{default:s(()=>[t(R,{name:"fa-solid fa-plus",color:"primary",size:"xs"})]),_:1})]),_:2},1032,["onClick"]))),128))]),_:1})]),_:1})]),_:1})]),m("div",yl,[t(le,{flat:"",bordered:""},{default:s(()=>[t(W,null,{default:s(()=>[a[35]||(a[35]=m("div",{class:"text-subtitle1 q-mb-sm"},"HTML Content",-1)),a[36]||(a[36]=m("p",{class:"text-caption q-mb-sm"},"Use the editor to create your template HTML content. Insert fields from the left panel.",-1)),t(It,{modelValue:P.value,"onUpdate:modelValue":[a[2]||(a[2]=o=>P.value=o),oe],"min-height":"400px",toolbar:[["bold","italic","strike","underline"],["left","center","right","justify"],["token","hr","link","custom_btn"],["quote","unordered","ordered"],["undo","redo","fullscreen"],["viewsource"]],definitions:{token:{tip:"Insert Field Placeholder",icon:"fa-solid fa-code",handler:p},custom_btn:{tip:"Insert Common Elements",icon:"fa-solid fa-puzzle-piece",handler:w}}},null,8,["modelValue","definitions"])]),_:1})]),_:1})])])]),_:1}),t(Ae,{name:"preview"},{default:s(()=>[t(le,{flat:"",bordered:""},{default:s(()=>[t(W,null,{default:s(()=>[a[37]||(a[37]=m("div",{class:"text-h6 q-mb-md"},"Form Preview",-1)),(_(!0),E(ce,null,me(v.value,(o,q)=>(_(),E("div",{key:"section-"+q},[m("div",_l,[m("div",bl,z(o.name),1)]),m("div",kl,[(_(!0),E(ce,null,me(i(o.name),y=>(_(),E("div",{key:y.id,class:Ge([y.width==="full"?"col-12":y.width==="half"?"col-12 col-md-6":y.width==="third"?"col-12 col-md-4":"col-12 col-md-6"])},[["text","email","password","tel","number"].includes(y.type)?(_(),D(j,{key:0,outlined:"",dense:"",type:y.type,label:y.label,placeholder:y.placeholder,hint:y.help_text,rules:y.required?[te=>!!te||"This field is required"]:[]},null,8,["type","label","placeholder","hint","rules"])):y.type==="select"?(_(),D(qe,{key:1,outlined:"",dense:"",label:y.label,placeholder:y.placeholder,hint:y.help_text,options:y.options||[],rules:y.required?[te=>!!te||"This field is required"]:[]},null,8,["label","placeholder","hint","options","rules"])):y.type==="textarea"?(_(),D(j,{key:2,outlined:"",type:"textarea",label:y.label,placeholder:y.placeholder,hint:y.help_text,rules:y.required?[te=>!!te||"This field is required"]:[]},null,8,["label","placeholder","hint","rules"])):y.type==="date"?(_(),D(j,{key:3,outlined:"",dense:"",type:"date",label:y.label,hint:y.help_text,rules:y.required?[te=>!!te||"This field is required"]:[]},null,8,["label","hint","rules"])):y.type==="radio"?(_(),D(Xe,{key:4,label:y.label,options:c(y.options||[]),type:"radio",modelValue:""},null,8,["label","options"])):y.type==="checkbox"?(_(),D(Le,{key:5,label:y.label},null,8,["label"])):(_(),E("div",wl,z(y.label)+": ["+z(y.type)+" field] ",1))],2))),128))])]))),128))]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])])]),t(Te,{modelValue:C.value,"onUpdate:modelValue":a[12]||(a[12]=o=>C.value=o),persistent:""},{default:s(()=>[t(le,{style:{"min-width":"500px"}},{default:s(()=>[t(W,{class:"row items-center"},{default:s(()=>[m("div",xl,z(V.value===-1?"Add Field":"Edit Field"),1),t(_e),J(t(A,{icon:"fa-solid fa-times",flat:"",round:"",dense:""},null,512),[[G]])]),_:1}),t(W,null,{default:s(()=>[m("div",Cl,[m("div",ql,[t(j,{modelValue:h.value.name,"onUpdate:modelValue":a[4]||(a[4]=o=>h.value.name=o),label:"Field Name *",outlined:"",dense:"",rules:[o=>!!o||"Field name is required"]},null,8,["modelValue","rules"])]),m("div",Sl,[t(j,{modelValue:h.value.label,"onUpdate:modelValue":a[5]||(a[5]=o=>h.value.label=o),label:"Display Label *",outlined:"",dense:"",rules:[o=>!!o||"Display label is required"]},null,8,["modelValue","rules"])]),m("div",Tl,[t(qe,{modelValue:h.value.type,"onUpdate:modelValue":a[6]||(a[6]=o=>h.value.type=o),options:Q,label:"Field Type *",outlined:"",dense:"","emit-value":"","map-options":""},null,8,["modelValue"])]),m("div",Fl,[t(qe,{modelValue:h.value.section_name,"onUpdate:modelValue":a[7]||(a[7]=o=>h.value.section_name=o),options:Y.value,label:"Section",outlined:"",dense:"","emit-value":"","map-options":""},null,8,["modelValue","options"])]),m("div",$l,[t(j,{modelValue:h.value.placeholder,"onUpdate:modelValue":a[8]||(a[8]=o=>h.value.placeholder=o),label:"Placeholder",outlined:"",dense:""},null,8,["modelValue"])]),m("div",Dl,[t(j,{modelValue:h.value.help_text,"onUpdate:modelValue":a[9]||(a[9]=o=>h.value.help_text=o),label:"Help Text",outlined:"",dense:""},null,8,["modelValue"])]),m("div",Pl,[t(qe,{modelValue:h.value.width,"onUpdate:modelValue":a[10]||(a[10]=o=>h.value.width=o),options:K,label:"Field Width",outlined:"",dense:"","emit-value":"","map-options":""},null,8,["modelValue"])]),["select","radio","checkbox"].includes(h.value.type)?(_(),E("div",El,[a[38]||(a[38]=m("div",{class:"text-subtitle2 q-mb-sm"},"Options",-1)),(_(!0),E(ce,null,me(ee.value,(o,q)=>(_(),E("div",{key:"option-"+q,class:"row q-col-gutter-sm q-mb-sm items-center"},[m("div",zl,[t(j,{modelValue:ee.value[q],"onUpdate:modelValue":y=>ee.value[q]=y,label:"Option",outlined:"",dense:"",rules:[y=>!!y||"Option is required"]},null,8,["modelValue","onUpdate:modelValue","rules"])]),m("div",Ol,[t(A,{round:"",flat:"",color:"negative",icon:"fa-solid fa-minus",onClick:y=>fe(q)},null,8,["onClick"])])]))),128)),t(A,{outline:"",color:"primary",label:"Add Option",class:"q-mt-sm",icon:"fa-solid fa-plus",onClick:x})])):X("",!0),m("div",Al,[t(Le,{modelValue:h.value.required,"onUpdate:modelValue":a[11]||(a[11]=o=>h.value.required=o),label:"This field is required"},null,8,["modelValue"])])])]),_:1}),t(Fe,{align:"right"},{default:s(()=>[J(t(A,{flat:"",label:"Cancel",color:"primary"},null,512),[[G]]),t(A,{unelevated:"",label:"Save Field",color:"primary",onClick:F,disable:!h.value.name||!h.value.label||!h.value.type},null,8,["disable"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),t(Te,{modelValue:L.value,"onUpdate:modelValue":a[14]||(a[14]=o=>L.value=o),persistent:""},{default:s(()=>[t(le,{style:{"min-width":"350px"}},{default:s(()=>[t(W,{class:"row items-center"},{default:s(()=>[m("div",Ll,z(k.value?"Edit Section":"Add Section"),1),t(_e),J(t(A,{icon:"fa-solid fa-times",flat:"",round:"",dense:"",onClick:Ce},null,512),[[G]])]),_:1}),t(W,null,{default:s(()=>[t(j,{modelValue:ie.value.name,"onUpdate:modelValue":a[13]||(a[13]=o=>ie.value.name=o),label:"Section Name *",outlined:"",rules:[o=>!!o||"Section name is required"]},null,8,["modelValue","rules"])]),_:1}),t(Fe,{align:"right"},{default:s(()=>[J(t(A,{flat:"",label:"Cancel",color:"primary",onClick:Ce},null,512),[[G]]),t(A,{unelevated:"",label:k.value?"Update Section":"Add Section",color:"primary",onClick:$e,disable:!ie.value.name},null,8,["label","disable"])]),_:1})]),_:1})]),_:1},8,["modelValue"])]))}});var Vl=je(Bl,[["__scopeId","data-v-7965c25f"]]),Nl=Ue({name:"QBanner",props:{...He,inlineActions:Boolean,dense:Boolean,rounded:Boolean},setup(l,{slots:e}){const{proxy:{$q:n}}=Qe(),d=Ie(l,n),f=I(()=>"q-banner row items-center"+(l.dense===!0?" q-banner--dense":"")+(d.value===!0?" q-banner--dark q-dark":"")+(l.rounded===!0?" rounded-borders":"")),T=I(()=>`q-banner__actions row items-center justify-end col-${l.inlineActions===!0?"auto":"all"}`);return()=>{const u=[B("div",{class:"q-banner__avatar col-auto row items-center self-start"},Se(e.avatar)),B("div",{class:"q-banner__content col text-body2"},Se(e.default))],v=Se(e.action);return v!==void 0&&u.push(B("div",{class:T.value},v)),B("div",{class:f.value+(l.inlineActions===!1&&v!==void 0?" q-banner--top-padding":""),role:"alert"},u)}}});const Ul={class:"template-fee-manager"},Hl={class:"q-mb-md"},Il={class:"row items-center"},Ql={class:"col-auto q-mr-md"},Ml={class:"col"},Rl={class:"text-h6 q-mb-xs"},jl={key:0,class:"text-caption text-grey"},Wl={key:0},Kl={class:"col-auto"},Yl={key:0,class:"q-mb-md"},Jl={class:"text-caption q-mt-xs"},Gl={key:1,class:"q-mb-md"},Xl={key:0},Zl={key:1},ea={key:0},ta=Me({__name:"TemplateFeeManager",props:{templateId:{type:Number,required:!0},templateName:{type:String,required:!0},isOwner:{type:Boolean,default:!1},isSystem:{type:Boolean,default:!1},initialFee:{type:Number,default:0}},setup(l){const e=l,n=Re(),d=xt(),f=S([]),T=S(!1),u=S(!1),v=S(!1),C=S({fee_name:"",fee_amount:0,fee_type:"fixed",currency:"PHP",description:""}),L=S(e.initialFee),k=I(()=>f.value.find(p=>p.is_active)),V=I(()=>f.value.find(p=>!p.is_active&&p.effective_to===null&&p.created_by===d.userId)),O=I(()=>f.value.filter(p=>p.effective_from!==null||p.is_active).sort((p,w)=>new Date(w.created_at).getTime()-new Date(p.created_at).getTime())),P=I(()=>{if(!k.value||!k.value.updated_by)return null;const p=f.value.find(w=>{var h;return w.username&&w.updated_by===((h=k.value)==null?void 0:h.updated_by)});return p&&(p.first_name||p.last_name)?`${p.first_name||""} ${p.last_name||""}`.trim():p&&p.username?p.username:"Administrator"}),Q=I(()=>V.value?!1:!!(d.isAdmin||e.isOwner||d.user&&d.user.is_notary));function K(p){return p.toFixed(2).replace(/\B(?=(\d{3})+(?!\d))/g,",")}function Y(p){return p?Et.formatDate(new Date(p),"MMM D, YYYY"):"N/A"}function Z(p){return p?p.first_name&&p.last_name?`${p.first_name} ${p.last_name}`:p.username?p.username:"":""}async function oe(){T.value=!0;try{const p=await Ze.getFeeSchedulesForTemplate(e.templateId);p.data.success?(f.value=p.data.data,p.data.template&&(L.value=p.data.template.fee_amount)):console.error("Error fetching fee schedules:",p.data.message)}catch(p){console.error("Error fetching fee schedules:",p)}finally{T.value=!1}}async function se(){if(!C.value.fee_amount||C.value.fee_amount<=0){n.notify({color:"warning",message:"Please enter a valid fee amount",icon:"warning"});return}u.value=!0;try{const p=await Ze.createFeeProposal(e.templateId,C.value);if(p.data.success)n.notify({color:"positive",message:"Fee proposal submitted successfully",icon:"check"}),v.value=!1,await oe(),C.value={fee_name:"",fee_amount:0,fee_type:"fixed",currency:"PHP",description:""};else throw new Error(p.data.message||"Failed to submit fee proposal")}catch(p){console.error("Error submitting fee proposal:",p),n.notify({color:"negative",message:p.message||"Failed to submit fee proposal",icon:"error"})}finally{u.value=!1}}return de(()=>e.templateId,p=>{p&&oe()}),ze(()=>{e.templateId&&oe(),C.value.fee_name=`Fee for ${e.templateName}`}),(p,w)=>(_(),E("div",Ul,[m("div",Hl,[w[5]||(w[5]=m("div",{class:"text-subtitle1 q-mb-sm"},"Current Fee",-1)),t(le,{bordered:"",flat:""},{default:s(()=>[t(W,null,{default:s(()=>[m("div",Il,[m("div",Ql,[t(R,{name:"payments",size:"md",color:"primary"})]),m("div",Ml,[m("div",Rl,z(L.value?`\u20B1${K(L.value)}`:"No fee set"),1),k.value?(_(),E("div",jl,[H(" Effective from "+z(Y(k.value.effective_from))+" ",1),P.value?(_(),E("span",Wl," \u2022 Approved by "+z(P.value),1)):X("",!0)])):X("",!0)]),m("div",Kl,[Q.value?(_(),D(A,{key:0,flat:"",color:"primary",label:"Propose Fee",onClick:w[0]||(w[0]=h=>v.value=!0)})):X("",!0)])])]),_:1})]),_:1})]),V.value?(_(),E("div",Yl,[t(Nl,{class:"bg-amber-1 text-grey-9"},{avatar:s(()=>[t(R,{name:"pending",color:"amber"})]),default:s(()=>[w[6]||(w[6]=m("div",{class:"text-weight-medium"},"Pending Fee Proposal",-1)),m("div",Jl," You've proposed a fee of \u20B1"+z(K(V.value.fee_amount))+" on "+z(Y(V.value.created_at))+". This proposal is awaiting admin approval. ",1)]),_:1})])):X("",!0),O.value.length>0?(_(),E("div",Gl,[w[8]||(w[8]=m("div",{class:"text-subtitle1 q-mb-sm"},"Fee History",-1)),t(Pe,{bordered:"",separator:""},{default:s(()=>[(_(!0),E(ce,null,me(O.value,h=>(_(),D(ne,{key:h.fee_id},{default:s(()=>[t(U,{avatar:""},{default:s(()=>[t(Ct,{color:h.is_active?"positive":"grey-6","text-color":"white"},{default:s(()=>[t(R,{name:h.is_active?"check":"history"},null,8,["name"])]),_:2},1032,["color"])]),_:2},1024),t(U,null,{default:s(()=>[t(ae,null,{default:s(()=>[H(" \u20B1"+z(K(h.fee_amount))+" ",1),h.is_active?(_(),D(at,{key:0,color:"positive",class:"q-ml-sm"},{default:s(()=>w[7]||(w[7]=[H("Active")])),_:1})):X("",!0)]),_:2},1024),t(ae,{caption:""},{default:s(()=>[H(z(h.fee_name)+" ",1),h.effective_from?(_(),E("span",Xl," \u2022 Effective from "+z(Y(h.effective_from)),1)):X("",!0),h.effective_to?(_(),E("span",Zl," \u2022 Until "+z(Y(h.effective_to)),1)):X("",!0)]),_:2},1024)]),_:2},1024),t(U,{side:""},{default:s(()=>[t(ae,{caption:""},{default:s(()=>[Z(h)?(_(),E("div",ea," Proposed by "+z(Z(h)),1)):X("",!0),m("div",null,z(Y(h.created_at)),1)]),_:2},1024)]),_:2},1024)]),_:2},1024))),128))]),_:1})])):X("",!0),t(Te,{modelValue:v.value,"onUpdate:modelValue":w[4]||(w[4]=h=>v.value=h)},{default:s(()=>[t(le,{style:{"min-width":"400px"}},{default:s(()=>[t(W,null,{default:s(()=>w[9]||(w[9]=[m("div",{class:"text-h6"},"Propose Template Fee",-1)])),_:1}),t(W,null,{default:s(()=>[w[10]||(w[10]=m("p",{class:"text-body2 q-mb-md"}," Please specify the fee amount for this template. The proposed fee will require admin approval before being activated. ",-1)),t(j,{modelValue:C.value.fee_amount,"onUpdate:modelValue":w[1]||(w[1]=h=>C.value.fee_amount=h),modelModifiers:{number:!0},type:"number",label:"Fee Amount (PHP) *",outlined:"",rules:[h=>!!h&&h>0||"Please enter a valid fee amount"],hint:"Enter the fee in Philippine Peso"},null,8,["modelValue","rules"]),t(j,{modelValue:C.value.fee_name,"onUpdate:modelValue":w[2]||(w[2]=h=>C.value.fee_name=h),label:"Fee Name",outlined:"",class:"q-mt-md",hint:"Optional: Provide a name or label for this fee"},null,8,["modelValue"]),t(j,{modelValue:C.value.description,"onUpdate:modelValue":w[3]||(w[3]=h=>C.value.description=h),type:"textarea",label:"Description",outlined:"",class:"q-mt-md",hint:"Optional: Provide additional details about this fee",autogrow:""},null,8,["modelValue"])]),_:1}),t(Fe,{align:"right"},{default:s(()=>[J(t(A,{flat:"",label:"Cancel",color:"grey"},null,512),[[G]]),t(A,{flat:"",label:"Submit Proposal",color:"primary",onClick:se,loading:u.value,disable:!C.value.fee_amount||C.value.fee_amount<=0},null,8,["loading","disable"])]),_:1})]),_:1})]),_:1},8,["modelValue"])]))}});var la=je(ta,[["__scopeId","data-v-64a4583c"]]);const aa={class:"row q-col-gutter-md"},oa={class:"col-12"},na={class:"row items-center justify-between"},sa={class:"q-mt-none q-mb-md"},ia={class:"col-12"},ra={class:"row q-col-gutter-md"},ua={class:"col-12 col-md-6"},da={class:"col-12 col-md-6"},ca={class:"col-12"},ma={key:0,class:"col-12"},pa={class:"col-12"},fa={class:"row justify-end q-gutter-sm"},va={class:"row q-col-gutter-md"},ha={class:"col-12 col-md-6"},ga={class:"col-12 col-md-6"},ya={class:"col-12"},_a={class:"text-h6"},ba=Me({__name:"CustomTemplateEditorPage",setup(l){const e=Re(),n=qt(),d=St(),f=Dt();Pt();const T=S(!1),u=S(0);S(0);const v=S([]),C=S([{id:"section_default",name:"Default",order:0}]),L=S(""),k=S(!1),V=S(!1),O=S(!1),P=S(null),Q=S(!1),K=S(0),Y=S(!1),Z=S(""),oe=S(""),se=S(null),p=Tt({custom_name:"",description:"",is_custom:!0}),w=I(()=>JSON.stringify({fields:v.value.map(F=>({id:F.id,name:F.name,label:F.label,type:F.type,placeholder:F.placeholder||"",required:F.required||!1,section_name:F.section_name||"Default",width:F.width||"full",options:F.options||[],default_value:F.default_value||"",help_text:F.help_text||""})),sections:C.value,html_content:L.value}));I(()=>!!p.custom_name&&!!p.description),I(()=>!!(!T.value||f.currentTemplate));const h=async()=>{if(n.params.id){T.value=!0;const F=Number(n.params.id);u.value=F;try{console.log(`Loading template ID: ${F}`);const b=await f.fetchTemplateDetails(F);if(console.log("Template details response:",b),b){const g=b;if(console.log("Template data:",g),console.log("Template fields:",g.fields),p.custom_name=g.template_name,p.description=g.description||"",g.fee_amount!==void 0&&(K.value=g.fee_amount),g.fields&&Array.isArray(g.fields)&&g.fields.length>0){const x=Array.isArray(g.fields)?g.fields:[];v.value=x.map(N=>({id:N.field_id?N.field_id.toString():"field_"+Date.now()+Math.floor(Math.random()*1e3),name:N.field_name,label:N.field_label,type:N.field_type,placeholder:N.placeholder||"",required:N.is_required,section_name:N.section_name||"Default",width:N.field_width||"full",options:N.field_options||[],default_value:N.default_value||"",help_text:N.help_text||"",order:N.field_order}));const fe=new Set;fe.add("Default"),v.value.forEach(N=>{N.section_name&&N.section_name.trim()!==""&&fe.add(N.section_name.trim())}),C.value=Array.from(fe).map((N,be)=>({id:N==="Default"?"section_default":"section_"+N.toLowerCase().replace(/[^a-z0-9]/g,"_"),name:N,order:be}))}else C.value=[{id:"section_default",name:"Default",order:0}];if(g.html_content){let x=g.html_content;typeof x=="string"&&(x=x.replace(/\\n/g,`
`),x=x.replace(/\r\n/g,`
`),x=x.replace(/\r/g,`
`)),L.value=x,console.log("Processed HTML content:",x)}(!v.value||!Array.isArray(v.value)||v.value.length===0)&&(v.value=[{id:"field_"+Date.now(),name:"field1",label:"Field 1",type:"text",placeholder:"Enter value",required:!0,section_name:"Default",width:"full",options:[],help_text:""}],console.log("Initialized with default field since none were loaded from API")),lt(()=>{Q.value=!1})}else console.error("Failed to load template details"),e.notify({color:"negative",message:"Failed to load template details"})}catch(b){console.error("Error loading template:",b),e.notify({color:"negative",message:"Error loading template: "+(b.message||"Unknown error")})}}else v.value=[{id:"field_"+Date.now(),name:"field1",label:"Field 1",type:"text",placeholder:"Enter value",required:!0,section_name:"Default",width:"full",options:[],help_text:""}],L.value=`
<h2>Template</h2>
<p>This is a template. Add your content here.</p>
<p>You can use field placeholders like {{field1}} in your content.</p>
`},ee=async()=>{if(!p.custom_name){e.notify({color:"negative",message:"Template name is required"});return}if(!p.description){e.notify({color:"negative",message:"Description is required"});return}k.value=!0;try{const F=JSON.parse(w.value);console.log("Saving template with content:",F);const b={template_name:p.custom_name,description:p.description,template_type:"custom",html_content:L.value||"",fields:v.value.map(x=>({field_name:x.name,field_label:x.label,field_type:x.type,field_options:x.options||[],is_required:x.required||!1,placeholder:x.placeholder||"",default_value:x.default_value||"",field_width:x.width||"full",section_name:x.section_name||"Default",help_text:x.help_text||""})),sections:C.value};if(b.html_content){let x=b.html_content;x=x.replace(/\\n/g,`
`),x=x.replace(/\r\n/g,`
`),x=x.replace(/\r/g,`
`),x=x.trim(),b.html_content=x,console.log("Processed HTML content before save:",x)}if(console.log("Template data being sent to API:",JSON.stringify(b)),!b.fields||b.fields.length===0){console.error("No fields to save!"),e.notify({color:"negative",message:"Template must have at least one field"}),k.value=!1;return}console.log("Fields to save:",b.fields),console.log("Sections to save:",b.sections);let g;if(console.log("Saving template data:",b),T.value&&u.value?(console.log(`Updating template with ID: ${u.value}`),g=await f.updateTemplate(u.value,b)):(console.log("Creating new template"),g=await f.createTemplate(b)),console.log("Template save response:",g),g&&g.success)e.notify({color:"positive",message:"Template saved successfully"}),Q.value=!1,d.push("/user/templates");else{const x=(g==null?void 0:g.message)||"Failed to save template";console.error("Error in save response:",x),e.notify({color:"negative",message:x})}}catch(F){console.error("Error saving template:",F),e.notify({color:"negative",message:`Error saving template: ${F.message||"Unknown error"}`})}finally{k.value=!1}},ie=async()=>{if(!p.custom_name){e.notify({color:"negative",message:"Template name is required"});return}if(!p.description){e.notify({color:"negative",message:"Description is required"});return}if(!P.value){e.notify({color:"negative",message:"Document is required"});return}V.value=!0;try{const F=new FormData;F.append("template_name",p.custom_name),F.append("description",p.description),F.append("document",P.value);const b=await f.uploadCustomTemplate(F);b.data.success?(e.notify({color:"positive",message:"Document uploaded successfully"}),O.value=!1,Q.value=!1,d.push({name:"user-templates"})):e.notify({color:"negative",message:b.data.message||"Failed to upload document"})}catch(F){console.error("Error uploading document:",F),e.notify({color:"negative",message:"Error uploading document"})}finally{V.value=!1}},ve=()=>{se.value&&se.value()},pe=()=>{Q.value?e.dialog({title:"Unsaved Changes",message:"You have unsaved changes. Are you sure you want to leave this page?",cancel:!0,persistent:!0}).onOk(()=>{d.push("/user/templates")}).onCancel(()=>{}):d.push("/user/templates")},he=()=>{["custom_name","description"].forEach(b=>{de(()=>p[b],()=>{Q.value=!0})}),de(v,()=>{Q.value=!0},{deep:!0}),de(C,()=>{Q.value=!0},{deep:!0}),de(L,()=>{Q.value=!0})};return ze(()=>{C.value.some(F=>F.name==="Default")||C.value.push({id:"section_default",name:"Default",order:0}),h(),he(),d.beforeEach((F,b,g)=>{(b.name==="create-template"||b.name==="edit-template")&&Q.value?e.dialog({title:"Unsaved Changes",message:"You have unsaved changes. Are you sure you want to leave this page?",cancel:!0,persistent:!0}).onOk(()=>{g()}).onCancel(()=>{g(!1)}):g()})}),(F,b)=>(_(),D(Ft,{padding:""},{default:s(()=>[m("div",aa,[m("div",oa,[m("div",na,[m("h4",sa,z(T.value?"Edit Template":"Create Template"),1),m("div",null,[t(A,{color:"primary",label:"Back to Templates",icon:"fa-solid fa-arrow-left",flat:"",onClick:pe})])])]),m("div",ia,[t(le,{flat:"",bordered:""},{default:s(()=>[t(W,null,{default:s(()=>[m("div",ra,[m("div",ua,[t(j,{modelValue:p.custom_name,"onUpdate:modelValue":b[0]||(b[0]=g=>p.custom_name=g),label:"Template Name *",outlined:"",rules:[g=>!!g||"Template name is required"]},null,8,["modelValue","rules"])]),m("div",da,[t(j,{modelValue:p.description,"onUpdate:modelValue":b[1]||(b[1]=g=>p.description=g),label:"Description *",outlined:"",rules:[g=>!!g||"Description is required"]},null,8,["modelValue","rules"])])])]),_:1})]),_:1})]),m("div",ca,[t(Vl,{fields:v.value,"onUpdate:fields":b[2]||(b[2]=g=>v.value=g),sections:C.value,"onUpdate:sections":b[3]||(b[3]=g=>C.value=g),"html-content":L.value,"onUpdate:htmlContent":b[4]||(b[4]=g=>L.value=g)},null,8,["fields","sections","html-content"])]),T.value&&u.value?(_(),E("div",ma,[t(le,{flat:"",bordered:""},{default:s(()=>[t(W,null,{default:s(()=>[b[10]||(b[10]=m("div",{class:"text-subtitle1 q-mb-sm"},"Template Fee Management",-1)),t(la,{"template-id":u.value,"template-name":p.custom_name,"is-owner":!0,"is-system":!1,"initial-fee":K.value},null,8,["template-id","template-name","initial-fee"])]),_:1})]),_:1})])):X("",!0),m("div",pa,[t(le,{flat:"",bordered:""},{default:s(()=>[t(W,null,{default:s(()=>[m("div",fa,[t(A,{flat:"",label:"Cancel",color:"grey",onClick:pe}),t(A,{unelevated:"",label:"Save Template",color:"primary",loading:k.value,onClick:ee},null,8,["loading"])])]),_:1})]),_:1})])]),t(Te,{modelValue:O.value,"onUpdate:modelValue":b[8]||(b[8]=g=>O.value=g),persistent:"",maximized:""},{default:s(()=>[t(le,null,{default:s(()=>[t(zt,{dark:""},{default:s(()=>[b[11]||(b[11]=m("div",{class:"text-subtitle1"},"Upload Document",-1)),t(_e),J(t(A,{icon:"close",flat:"",round:"",dense:""},null,512),[[G]])]),_:1}),t(W,null,{default:s(()=>[m("div",va,[m("div",ha,[t(j,{modelValue:p.custom_name,"onUpdate:modelValue":b[5]||(b[5]=g=>p.custom_name=g),label:"Template Name *",outlined:"",rules:[g=>!!g||"Template name is required"]},null,8,["modelValue","rules"])]),m("div",ga,[t(j,{modelValue:p.description,"onUpdate:modelValue":b[6]||(b[6]=g=>p.description=g),label:"Description *",outlined:"",rules:[g=>!!g||"Description is required"]},null,8,["modelValue","rules"])]),m("div",ya,[t($t,{modelValue:P.value,"onUpdate:modelValue":b[7]||(b[7]=g=>P.value=g),label:"Upload Document *",outlined:"",accept:".pdf,.doc,.docx","use-chips":"",rules:[g=>!!g||"Document is required"]},{prepend:s(()=>[t(R,{name:"attach_file"})]),hint:s(()=>b[12]||(b[12]=[H(" Supported formats: PDF, DOC, DOCX ")])),_:1},8,["modelValue","rules"])])])]),_:1}),t(Fe,{align:"right"},{default:s(()=>[J(t(A,{flat:"",label:"Cancel",color:"grey"},null,512),[[G]]),t(A,{unelevated:"",label:"Upload",color:"primary",loading:V.value,onClick:ie},null,8,["loading"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),t(Te,{modelValue:Y.value,"onUpdate:modelValue":b[9]||(b[9]=g=>Y.value=g),persistent:""},{default:s(()=>[t(le,null,{default:s(()=>[t(W,null,{default:s(()=>[m("div",_a,z(Z.value),1)]),_:1}),t(W,null,{default:s(()=>[H(z(oe.value),1)]),_:1}),t(Fe,{align:"right"},{default:s(()=>[J(t(A,{flat:"",label:"Cancel",color:"primary"},null,512),[[G]]),J(t(A,{unelevated:"",label:"Proceed",color:"primary",onClick:ve},null,512),[[G]])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1}))}});var Fa=je(ba,[["__scopeId","data-v-31d5f4ab"]]);export{Fa as default};
