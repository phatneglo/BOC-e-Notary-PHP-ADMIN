import{_ as z,d as K,f as Z,r as i,o as G,j as f,k as J,l as s,az as L,F as o,m as t,aB as g,by as O,aK as q,E as W,bx as _,t as n,q as B,p as u,aD as C,C as Q,D as V,s as k,aZ as R,H as N,a_ as E,S as U}from"./index.fe3d6851.js";import{d as X}from"./date.fa239a2b.js";import{F as D}from"./feeSchedule.e7ed974e.js";import"./axios.bcc89ad9.js";const ee={class:"row q-col-gutter-md"},ae={class:"col-12"},oe={class:"text-weight-bold"},te={class:"text-caption text-grey"},le={key:0},se={class:"row q-mb-md"},re={class:"col-8 text-weight-medium"},ne={class:"row q-mb-md"},ie={class:"col-8"},de={class:"row q-mb-md"},ue={class:"col-8"},ce={class:"text-caption"},pe={class:"row q-mb-md"},me={class:"col-8"},ve={class:"row q-mb-md"},fe={class:"col-8 text-weight-bold"},ge={key:0,class:"row q-mb-md"},_e={class:"col-8"},ye={key:0},be={class:"row q-mb-md"},we={class:"col-8 text-weight-medium"},xe={class:"row q-mb-md"},Fe={class:"col-8 text-weight-bold"},Pe=K({__name:"FeeApprovalPage",setup(he){const d=Z(),y=i(!1),j=i([]),b=i(""),S=i({rowsPerPage:10}),p=i(!1),m=i(!1),r=i(null),v=i({fee_amount:0}),c=i({reason:""}),w=i(!1),x=i(!1),T=[{name:"template_name",required:!0,label:"Template",align:"left",field:"template_name",sortable:!0},{name:"category_name",label:"Category",align:"left",field:"category_name",sortable:!0},{name:"fee_amount",label:"Proposed Fee",align:"right",field:"fee_amount",sortable:!0},{name:"proposed_by",label:"Proposed By",align:"left",field:e=>h(e),sortable:!0},{name:"created_at",label:"Date Proposed",align:"left",field:"created_at",sortable:!0},{name:"actions",label:"Actions",align:"center",field:"actions"}];G(async()=>{await F()});async function F(){y.value=!0;try{const e=await D.getPendingFeeProposals();if(e.data.success)j.value=e.data.data;else throw new Error(e.data.message||"Failed to load fee proposals")}catch(e){console.error("Error fetching pending fees:",e),d.notify({color:"negative",message:"Failed to load fee proposals",icon:"error"})}finally{y.value=!1}}function P(e){return e.toFixed(2).replace(/\B(?=(\d{3})+(?!\d))/g,",")}function A(e){return X.formatDate(new Date(e),"MMM D, YYYY h:mm A")}function h(e){return e?e.first_name&&e.last_name?`${e.first_name} ${e.last_name}`:e.username?e.username:`User #${e.created_by}`:""}function $(e){r.value=e,v.value.fee_amount=e.fee_amount,p.value=!0}function M(e){r.value=e,c.value.reason="",m.value=!0}async function Y(){if(!!r.value){w.value=!0;try{const e=await D.approveFeeProposal(r.value.fee_id,v.value);if(e.data.success)d.notify({color:"positive",message:"Fee proposal approved successfully",icon:"check"}),p.value=!1,await F();else throw new Error(e.data.message||"Failed to approve fee proposal")}catch(e){console.error("Error approving fee:",e),d.notify({color:"negative",message:e.message||"Failed to approve fee proposal",icon:"error"})}finally{w.value=!1}}}async function I(){if(!r.value||!c.value.reason){d.notify({color:"warning",message:"Please provide a reason for rejection",icon:"warning"});return}x.value=!0;try{const e=await D.rejectFeeProposal(r.value.fee_id,c.value);if(e.data.success)d.notify({color:"positive",message:"Fee proposal rejected successfully",icon:"check"}),m.value=!1,await F();else throw new Error(e.data.message||"Failed to reject fee proposal")}catch(e){console.error("Error rejecting fee:",e),d.notify({color:"negative",message:e.message||"Failed to reject fee proposal",icon:"error"})}finally{x.value=!1}}return(e,a)=>(f(),J(L,{padding:""},{default:s(()=>[o("div",ee,[a[6]||(a[6]=o("div",{class:"col-12"},[o("div",{class:"text-h5 q-mb-md"},"Fee Approval"),o("p",{class:"text-grey-8"},"Review and manage template fee proposals from notaries and template owners.")],-1)),o("div",ae,[t(C,{flat:"",bordered:""},{default:s(()=>[t(g,null,{default:s(()=>a[5]||(a[5]=[o("div",{class:"text-h6"},"Pending Fee Proposals",-1)])),_:1}),t(g,null,{default:s(()=>[t(O,{rows:j.value,columns:T,"row-key":"fee_id",loading:y.value,filter:b.value,"no-data-label":"No pending fee proposals",pagination:S.value},{top:s(()=>[t(q,{modelValue:b.value,"onUpdate:modelValue":a[0]||(a[0]=l=>b.value=l),debounce:"300",placeholder:"Search by template name, user, category...",dense:"",outlined:"",class:"q-mb-md"},{append:s(()=>[t(W,{name:"search"})]),_:1},8,["modelValue"])]),"body-cell-fee_amount":s(l=>[t(_,{props:l},{default:s(()=>[o("div",oe,"\u20B1"+n(P(l.row.fee_amount)),1)]),_:2},1032,["props"])]),"body-cell-proposed_by":s(l=>[t(_,{props:l},{default:s(()=>[o("div",null,n(h(l.row)),1),o("div",te,n(l.row.is_notary?"Notary Public":"Regular User"),1)]),_:2},1032,["props"])]),"body-cell-created_at":s(l=>[t(_,{props:l},{default:s(()=>[B(n(A(l.row.created_at)),1)]),_:2},1032,["props"])]),"body-cell-actions":s(l=>[t(_,{props:l},{default:s(()=>[t(u,{flat:"",color:"positive",icon:"check",onClick:H=>$(l.row),label:"Approve",dense:"",class:"q-mr-sm"},null,8,["onClick"]),t(u,{flat:"",color:"negative",icon:"close",onClick:H=>M(l.row),label:"Reject",dense:""},null,8,["onClick"])]),_:2},1032,["props"])]),_:1},8,["rows","loading","filter","pagination"])]),_:1})]),_:1})])]),t(E,{modelValue:p.value,"onUpdate:modelValue":a[2]||(a[2]=l=>p.value=l)},{default:s(()=>[t(C,{style:{"min-width":"400px"}},{default:s(()=>[t(g,null,{default:s(()=>[a[14]||(a[14]=o("div",{class:"text-h6"},"Approve Fee Proposal",-1)),t(Q,{class:"q-my-md"}),r.value?(f(),V("div",le,[o("div",se,[a[7]||(a[7]=o("div",{class:"col-12 q-mb-sm text-subtitle1"},"Template Information",-1)),a[8]||(a[8]=o("div",{class:"col-4 text-grey-8"},"Template Name:",-1)),o("div",re,n(r.value.template_name),1)]),o("div",ne,[a[9]||(a[9]=o("div",{class:"col-4 text-grey-8"},"Category:",-1)),o("div",ie,n(r.value.category_name),1)]),o("div",de,[a[10]||(a[10]=o("div",{class:"col-4 text-grey-8"},"Proposed By:",-1)),o("div",ue,[B(n(h(r.value))+" ",1),o("div",ce,n(r.value.is_notary?"Notary Public":"Regular User"),1)])]),o("div",pe,[a[11]||(a[11]=o("div",{class:"col-4 text-grey-8"},"Proposed Date:",-1)),o("div",me,n(A(r.value.created_at)),1)]),o("div",ve,[a[12]||(a[12]=o("div",{class:"col-4 text-grey-8"},"Proposed Fee:",-1)),o("div",fe,"\u20B1"+n(P(r.value.fee_amount)),1)]),r.value.description?(f(),V("div",ge,[a[13]||(a[13]=o("div",{class:"col-4 text-grey-8"},"Description:",-1)),o("div",_e,n(r.value.description),1)])):k("",!0)])):k("",!0),t(q,{modelValue:v.value.fee_amount,"onUpdate:modelValue":a[1]||(a[1]=l=>v.value.fee_amount=l),modelModifiers:{number:!0},type:"number",label:"Fee Amount (PHP)",hint:"You can adjust the proposed fee if needed",outlined:"",class:"q-mt-md"},null,8,["modelValue"])]),_:1}),t(R,{align:"right"},{default:s(()=>[N(t(u,{flat:"",label:"Cancel",color:"grey"},null,512),[[U]]),t(u,{flat:"",label:"Approve",color:"positive",onClick:Y,loading:w.value},null,8,["loading"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),t(E,{modelValue:m.value,"onUpdate:modelValue":a[4]||(a[4]=l=>m.value=l)},{default:s(()=>[t(C,{style:{"min-width":"400px"}},{default:s(()=>[t(g,null,{default:s(()=>[a[17]||(a[17]=o("div",{class:"text-h6"},"Reject Fee Proposal",-1)),t(Q,{class:"q-my-md"}),r.value?(f(),V("div",ye,[o("div",be,[a[15]||(a[15]=o("div",{class:"col-4 text-grey-8"},"Template Name:",-1)),o("div",we,n(r.value.template_name),1)]),o("div",xe,[a[16]||(a[16]=o("div",{class:"col-4 text-grey-8"},"Proposed Fee:",-1)),o("div",Fe,"\u20B1"+n(P(r.value.fee_amount)),1)])])):k("",!0),t(q,{modelValue:c.value.reason,"onUpdate:modelValue":a[3]||(a[3]=l=>c.value.reason=l),type:"textarea",label:"Reason for Rejection",hint:"Provide feedback to the template creator",outlined:"",autogrow:""},null,8,["modelValue"])]),_:1}),t(R,{align:"right"},{default:s(()=>[N(t(u,{flat:"",label:"Cancel",color:"grey"},null,512),[[U]]),t(u,{flat:"",label:"Reject",color:"negative",onClick:I,loading:x.value},null,8,["loading"])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1}))}});var De=z(Pe,[["__scopeId","data-v-01dcb333"]]);export{De as default};
