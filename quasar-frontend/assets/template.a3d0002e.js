import{ax as p,aA as l}from"./index.fce983f6.js";import{api as o}from"./axios.2d0d75cc.js";const h=p("template",{state:()=>({templates:[],totalCount:0,currentTemplate:null,categories:[],isLoading:!1,error:null,isSaving:!1,isUploading:!1}),actions:{async createTemplate(r){var a,s;this.isLoading=!0,this.error=null;try{const e=await o.post("/templates",r);return console.log("Create template response:",e.data),e.data.success?(this.fetchTemplates(),{success:!0,message:"Template created successfully",data:e.data.data}):(this.error=e.data.message||"Failed to create template",{success:!1,message:this.error})}catch(e){return console.error("Error creating template:",e),this.error=((s=(a=e.response)==null?void 0:a.data)==null?void 0:s.message)||"Failed to create template",l.create({type:"negative",message:this.error}),{success:!1,message:this.error}}finally{this.isLoading=!1}},async updateTemplate(r,a){var s,e;this.isLoading=!0,this.error=null;try{const t=await o.put(`/templates/${r}`,a);return console.log("Update template response:",t.data),t.data.success?(this.fetchTemplates(),{success:!0,message:"Template updated successfully",data:t.data.data}):(this.error=t.data.message||"Failed to update template",{success:!1,message:this.error})}catch(t){return console.error("Error updating template:",t),this.error=((e=(s=t.response)==null?void 0:s.data)==null?void 0:e.message)||"Failed to update template",l.create({type:"negative",message:this.error}),{success:!1,message:this.error}}finally{this.isLoading=!1}},addField(r,a){if(this.currentTemplate){const s={...a,field_id:Date.now()};return this.currentTemplate.fields||(this.currentTemplate.fields=[]),this.currentTemplate.fields.push(s),!0}return!1},updateField(r,a){if(this.currentTemplate&&this.currentTemplate.fields){const s=this.currentTemplate.fields.findIndex(e=>e.field_id===r);if(s!==-1)return this.currentTemplate.fields[s]={...this.currentTemplate.fields[s],...a},!0}return!1},deleteField(r){return this.currentTemplate&&this.currentTemplate.fields?(this.currentTemplate.fields=this.currentTemplate.fields.filter(a=>a.field_id!==r),!0):!1},async fetchTemplates(r={}){var a,s,e;this.isLoading=!0,this.error=null;try{const t={...r};t.owner_id===!0||t.owner_id||delete t.owner_id,console.log("Fetching templates with params:",t);const i=await o.get("/templates",{params:t});return i.data.success?(this.templates=i.data.data,this.totalCount=((a=i.data.meta)==null?void 0:a.total)||0,console.log(`Retrieved ${this.templates.length} templates:`,this.templates.map(n=>({id:n.template_id,name:n.template_name,is_system:n.is_system,owner_id:n.owner_id})))):this.error=i.data.message||"Failed to fetch templates",i.data}catch(t){throw console.error("Error fetching templates:",t),this.error=((e=(s=t.response)==null?void 0:s.data)==null?void 0:e.message)||"Failed to fetch templates",t}finally{this.isLoading=!1}},async fetchTemplateCategories(){var r,a;this.isLoading=!0,this.error=null;try{const s=await o.get("/templates/categories");return s.data.success?this.categories=s.data.data:this.error=s.data.message||"Failed to fetch template categories",s.data}catch(s){throw console.error("Error fetching template categories:",s),this.error=((a=(r=s.response)==null?void 0:r.data)==null?void 0:a.message)||"Failed to fetch template categories",l.create({type:"negative",message:this.error}),s}finally{this.isLoading=!1}},async fetchTemplateDetails(r){var a,s;this.isLoading=!0,this.error=null;try{console.log(`Fetching template details for ID: ${r}`);const e=await o.get(`/templates/${r}`);if(console.log("Template details response:",e.data),e.data.success){const t=e.data.data;return t.html_content&&typeof t.html_content=="string"&&(t.html_content=t.html_content.replace(/\\n/g,`
`),t.html_content=t.html_content.replace(/\r\n/g,`
`),t.html_content=t.html_content.replace(/\r/g,`
`)),t.fields&&Array.isArray(t.fields)?(t.fields=t.fields.map(i=>{if(i.field_options&&typeof i.field_options=="string")try{i.field_options=JSON.parse(i.field_options)}catch{i.field_options=i.field_options.split(",").map(c=>c.trim())}else i.field_options||(i.field_options=[]);return i.field_width||(i.field_width="full"),i.section_name||(i.section_name="Default"),i}),console.log(`Processed ${t.fields.length} template fields:`,t.fields)):(console.warn("No fields found in template or fields not in correct format"),t.fields=[]),this.currentTemplate=t,t}else return this.error=e.data.message||"Failed to get template details",l.create({type:"negative",message:this.error}),{success:!1,message:this.error}}catch(e){return console.error("Error getting template details:",e),this.error=((s=(a=e.response)==null?void 0:a.data)==null?void 0:s.message)||"Failed to get template details",l.create({type:"negative",message:this.error}),{success:!1,message:this.error}}finally{this.isLoading=!1}},async generatePreview(r,a={}){var s,e;this.isLoading=!0,this.error=null;try{const t=await o.post(`/templates/${r}/generate-pdf`,a);return t.data.success||(this.error=t.data.message||"Failed to generate template preview"),t.data}catch(t){throw console.error("Error generating template preview:",t),this.error=((e=(s=t.response)==null?void 0:s.data)==null?void 0:e.message)||"Failed to generate template preview",l.create({type:"negative",message:this.error}),t}finally{this.isLoading=!1}},async fetchUserOwnedTemplate(r){var a,s;this.isLoading=!0,this.error=null;try{const e=await o.get(`/templates/${r}`);return e.data.success?this.currentTemplate=e.data.data:this.error=e.data.message||"Failed to get template details",e.data}catch(e){throw console.error("Error getting template details:",e),this.error=((s=(a=e.response)==null?void 0:a.data)==null?void 0:s.message)||"Failed to get template details",l.create({type:"negative",message:this.error}),e}finally{this.isLoading=!1}},async duplicateTemplate(r,a){var s,e;this.isLoading=!0,this.error=null;try{console.log("Requesting template duplication, ID:",r);const t=await o.post(`/templates/${r}/duplicate`,{template_name:a.template_name,description:a.description||""});return console.log("Duplicate template response:",t.data),t.data.success?(l.create({type:"positive",message:"Template duplicated successfully"}),await this.fetchTemplates(),{success:!0,data:t.data.data,message:"Template duplicated successfully"}):(this.error=t.data.message||"Failed to duplicate template",l.create({type:"negative",message:this.error}),{success:!1,message:this.error})}catch(t){return console.error("Error duplicating template:",t),this.error=((e=(s=t.response)==null?void 0:s.data)==null?void 0:e.message)||t.message||"Failed to duplicate template",l.create({type:"negative",message:this.error}),{success:!1,message:this.error}}finally{this.isLoading=!1}},async saveTemplate(r){var a,s;this.isSaving=!0,this.error=null;try{let e;return r.template_id?e=await o.put(`/templates/${r.template_id}`,r):e=await o.post("/templates",r),e.data.success?(l.create({type:"positive",message:"Template saved successfully"}),this.fetchTemplates()):(this.error=e.data.message||"Failed to save template",l.create({type:"negative",message:this.error})),e.data}catch(e){throw console.error("Error saving template:",e),this.error=((s=(a=e.response)==null?void 0:a.data)==null?void 0:s.message)||"Failed to save template",l.create({type:"negative",message:this.error}),e}finally{this.isSaving=!1}},async uploadCustomTemplate(r){var a,s;this.isUploading=!0,this.error=null;try{const e=await o.post("/templates/upload",r,{headers:{"Content-Type":"multipart/form-data"}});return e.data.success?l.create({type:"positive",message:"Custom template uploaded successfully"}):(this.error=e.data.message||"Failed to upload custom template",l.create({type:"negative",message:this.error})),e.data}catch(e){throw console.error("Error uploading custom template:",e),this.error=((s=(a=e.response)==null?void 0:a.data)==null?void 0:s.message)||"Failed to upload custom template",l.create({type:"negative",message:this.error}),e}finally{this.isUploading=!1}},clearCurrentTemplate(){this.currentTemplate=null},async deleteTemplate(r){var a,s;this.isLoading=!0,this.error=null;try{const e=await o.delete(`/templates/${r}`);return e.data.success?(this.fetchTemplates(),l.create({type:"positive",message:"Template deleted successfully"})):(this.error=e.data.message||"Failed to delete template",l.create({type:"negative",message:this.error})),e.data}catch(e){throw console.error("Error deleting template:",e),this.error=((s=(a=e.response)==null?void 0:a.data)==null?void 0:s.message)||"Failed to delete template",l.create({type:"negative",message:this.error}),e}finally{this.isLoading=!1}},async fetchUserOwnedTemplates(){return this.fetchTemplates({owner_id:!0})}}});export{h as u};
